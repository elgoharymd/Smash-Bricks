https://elgoharymd.github.io/Smash-Bricks/            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 255, 255, 0.3);
            overflow: hidden;
            margin: 20px;
            aspect-ratio: 380/650;
            border: 1px solid #00ffff;
        }
        
        #game-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        #start-screen, #game-over-screen, #shop-screen, #levels-screen, #background-select-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 10;
            text-align: center;
            padding: 20px;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(0, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255, 0, 255, 0.1) 0%, transparent 50%);
        }
        
        #game-over-screen, #shop-screen, #levels-screen, #background-select-screen {
            display: none;
        }
        
        .game-logo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin-bottom: 20px;
            border: 3px solid #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
            object-fit: cover;
            animation: pulse 2s infinite alternate;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #00ffff;
            text-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff;
            background: linear-gradient(90deg, #00ffff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 2px;
        }
        
        h2 {
            font-size: 1.8rem;
            margin: 15px 0;
            color: #00ffaa;
            text-shadow: 0 0 5px #00ffaa;
        }
        
        p {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: #EEE;
            line-height: 1.5;
        }
        
        .btn {
            background: linear-gradient(45deg, #00aaff, #0088ff);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(0, 170, 255, 0.5);
            font-weight: bold;
            margin: 8px 0;
            width: 80%;
            max-width: 250px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0, 255, 255, 0.5);
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                transparent 45%,
                rgba(0, 255, 255, 0.5) 50%,
                transparent 55%
            );
            transform: rotate(30deg);
            animation: shine 3s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.05); }
        }
        
        @keyframes shine {
            0% { transform: translateX(-100%) rotate(30deg); }
            100% { transform: translateX(100%) rotate(30deg); }
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 20px rgba(0, 170, 255, 0.8);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #aa00ff, #8800ff);
        }
        
        .btn-shop {
            background: linear-gradient(45deg, #00ffaa, #00cc88);
        }
        
        .btn-settings {
            background: linear-gradient(45deg, #ff00aa, #cc0088);
        }
        
        .btn-premium {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }
        
        #score-display {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            z-index: 5;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid #00ffff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        #high-score-display {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 1.2rem;
            color: #00ffff;
            z-index: 5;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid #00ffff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        #coins-display {
            position: absolute;
            top: 70px;
            right: 20px;
            font-size: 1.2rem;
            color: #ffcc00;
            z-index: 5;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid #ffcc00;
            box-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
        }
        
        #level-display {
            position: absolute;
            top: 70px;
            left: 20px;
            font-size: 1.2rem;
            color: #00ffaa;
            z-index: 5;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid #00ffaa;
            box-shadow: 0 0 10px rgba(0, 255, 170, 0.5);
        }
        
        #final-score, #new-high-score {
            font-size: 1.5rem;
            margin: 10px 0;
            color: #00ffff;
            text-shadow: 0 0 5px #00ffff;
        }
        
        #new-high-score {
            display: none;
            animation: pulse 1.5s infinite;
        }
        
        .instructions {
            position: absolute;
            bottom: 20px;
            width: 80%;
            text-align: center;
            font-size: 0.9rem;
            color: #AAA;
        }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ØªØ¬Ø± */
        .shop-items {
            width: 100%;
            max-height: 60%;
            overflow-y: auto;
            margin: 15px 0;
            padding: 0 10px;
        }
        
        .shop-item {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            border: 1px solid rgba(0, 255, 255, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .shop-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                45deg,
                transparent 45%,
                rgba(0, 255, 255, 0.1) 50%,
                transparent 55%
            );
            animation: shine 3s infinite;
        }
        
        .shop-item:hover {
            background: rgba(0, 255, 255, 0.1);
            transform: translateY(-3px);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }
        
        .ball-preview {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-left: 15px;
            box-shadow: 0 0 15px currentColor;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .ball-preview::after {
            content: '';
            position: absolute;
            top: 10%;
            left: 10%;
            width: 20%;
            height: 20%;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.8);
            filter: blur(1px);
        }
        
        .item-info {
            flex: 1;
            text-align: right;
        }
        
        .item-name {
            font-weight: bold;
            font-size: 1.1rem;
            color: white;
            text-shadow: 0 0 5px currentColor;
        }
        
        .item-price {
            color: #ffcc00;
            font-size: 0.9rem;
            text-shadow: 0 0 5px #ffcc00;
        }
        
        .item-description {
            color: #AAA;
            font-size: 0.8rem;
            margin-top: 5px;
        }
        
        .buy-btn {
            background: linear-gradient(45deg, #00ffaa, #00cc88);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(0, 255, 255, 0.5);
            box-shadow: 0 0 10px rgba(0, 255, 170, 0.5);
        }
        
        .buy-btn:disabled {
            background: #333;
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .owned-badge {
            background: linear-gradient(45deg, #00ffaa, #00cc88);
            color: black;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-left: 10px;
            font-weight: bold;
            box-shadow: 0 0 10px rgba(0, 255, 170, 0.5);
        }
        
        .premium-badge {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: black;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-left: 10px;
            font-weight: bold;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ø±Ø§Ø­Ù„ */
        .levels-container {
            width: 100%;
            max-height: 60%;
            overflow-y: auto;
            margin: 15px 0;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 0 10px;
        }
        
        .level-card {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(0, 255, 255, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .level-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                45deg,
                transparent 45%,
                rgba(0, 255, 255, 0.1) 50%,
                transparent 55%
            );
            animation: shine 3s infinite;
        }
        
        .level-card.locked {
            filter: grayscale(80%);
            opacity: 0.7;
        }
        
        .level-card.unlocked:hover {
            background: rgba(0, 255, 255, 0.1);
            transform: translateY(-3px);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }
        
        .level-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #00ffff;
            text-shadow: 0 0 5px #00ffff;
        }
        
        .level-difficulty {
            font-size: 0.8rem;
            color: #AAA;
            margin: 5px 0;
        }
        
        .level-requirements {
            font-size: 0.7rem;
            color: #ffcc00;
            margin-top: 5px;
            text-shadow: 0 0 3px #ffcc00;
        }
        
        .lock-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            color: rgba(255, 255, 255, 0.5);
        }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ© Ù„Ù„ÙƒØ±Ø© */
        .gravity-effect {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        ::-webkit-scrollbar {
            width: 5px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(0, 255, 255, 0.3);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 255, 255, 0.5);
        }
        
        /* Ø®Ù„ÙÙŠØ§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© */
        .background-options {
            width: 100%;
            max-height: 60%;
            overflow-y: auto;
            margin: 15px 0;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 0 10px;
        }
        
        .background-option {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 10px;
            text-align: center;
            border: 1px solid rgba(0, 255, 255, 0.3);
            transition: all 0.3s ease;
            position: relative;
            aspect-ratio: 1/1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        .background-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                45deg,
                transparent 45%,
                rgba(0, 255, 255, 0.1) 50%,
                transparent 55%
            );
            animation: shine 3s infinite;
        }
        
        .background-option:hover {
            background: rgba(0, 255, 255, 0.1);
            transform: translateY(-3px);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }
        
        .background-preview {
            width: 80%;
            height: 80%;
            border-radius: 10px;
            background-size: cover;
            background-position: center;
            margin-bottom: 5px;
            border: 1px solid rgba(0, 255, 255, 0.5);
        }
        
        .background-name {
            font-size: 0.9rem;
            color: white;
            margin-top: 5px;
        }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© */
        .ball-glow {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            filter: blur(10px);
            opacity: 0.7;
            z-index: -1;
        }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª Ø§Ù„Ø´ÙØ§ÙØ© */
        .obstacle-glow {
            position: absolute;
            width: 100%;
            height: 100%;
            filter: blur(5px);
            opacity: 0.8;
            z-index: -1;
        }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø±ÙƒØ© */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .floating {
            animation: float 3s ease-in-out infinite;
        }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ØªÙˆÙ‡Ø¬ */
        @keyframes glow {
            0% { box-shadow: 0 0 5px #00ffff; }
            50% { box-shadow: 0 0 20px #00ffff; }
            100% { box-shadow: 0 0 5px #00ffff; }
        }
        
        /* Ø²Ø± Ø±ÙØ¹ Ø§Ù„Ø®Ù„ÙÙŠØ© */
        #upload-btn {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #00ffff;
            color: #00ffff;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            z-index: 20;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        #upload-btn:hover {
            background: rgba(0, 255, 255, 0.2);
        }
        
        #file-input {
            display: none;
        }
        
        /* ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ */
        @media (max-width: 400px) {
            h1 {
                font-size: 2rem;
            }
            
            .game-logo {
                width: 100px;
                height: 100px;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 1rem;
            }
            
            #score-display, #high-score-display {
                font-size: 1.2rem;
                padding: 5px 10px;
            }
            
            #coins-display, #level-display {
                font-size: 1rem;
                padding: 5px 10px;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="score-display">Ø§Ù„Ù†Ù‚Ø§Ø·: 0</div>
        <div id="high-score-display">Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø©: 0</div>
        <div id="coins-display">Ø§Ù„Ø¹Ù…Ù„Ø§Øª: 0</div>
        <div id="level-display">Ø§Ù„Ù…Ø±Ø­Ù„Ø©: 1</div>
        
        <canvas id="game-canvas"></canvas>
        
        <button id="upload-btn">Ø±ÙØ¹ Ø®Ù„ÙÙŠØ©</button>
        <input type="file" id="file-input" accept="image/*,video/*">
        
        <div id="start-screen">
            <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgTeQanJ58k8K8Rdx0xbACKt9G0sKnhAbFkAKeHYccvvm8xwhckiLTBTa6dD_sR7QK-uzdDbw4rP3jB3uDHPHjWM8ZN5h-IL7q85eGfLmQ2CV0vuOMI2conWcvUVPOstcpIA4N4t720FV310JNHXSFQmif5GMmt2GbfKo4Io53_aKgpjSImTb76lY36nyuw/s1280/IMG-20250814-WA0003.jpg" class="game-logo" alt="Barrier Blitz Logo">
            <h1 class="floating">Barrier Blitz</h1>
            <p>Ø£ØµØ¹Ø¨ ØªØ­Ø¯ÙŠ Ù‡Ù„ Ø£Ù†Øª Ø¬Ø§Ù‡Ø²!! ğŸ’€</p>
            <button class="btn" id="start-btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨</button>
            <button class="btn btn-secondary" id="levels-btn">Ø§Ù„Ù…Ø±Ø§Ø­Ù„</button>
            <button class="btn btn-shop" id="shop-btn">Ù…ØªØ¬Ø± Ø§Ù„ÙƒØ±Ø§Øª</button>
            <button class="btn btn-settings" id="background-btn">Ø®Ù„ÙÙŠØ§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©</button>

            <div class="instructions">
                Ø§Ø¶ØºØ· Ù„Ù„Ù‚ÙØ² | ØªØ¬Ù†Ø¨ Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª | Ø§Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ù…Ù„Ø§Øª
            </div>
        </div>
        
        <div id="game-over-screen">
            <h1>Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©!</h1>
            <div id="final-score">Ø§Ù„Ù†Ù‚Ø§Ø·: 0</div>
            <div id="new-high-score">!ØªØ­Ù‚ÙŠÙ‚ Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø© Ø¬Ø¯ÙŠØ¯Ø©</div>
            <button class="btn" id="restart-btn">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
            <button class="btn btn-secondary" id="back-to-menu-btn">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
            <div class="instructions">
                Ù„Ù‚Ø¯ ÙƒØ³Ø¨Øª <span id="earned-coins">0</span> Ø¹Ù…Ù„Ø© ÙØ¶Ø§Ø¦ÙŠØ©!
            </div>
        </div>
        
        <div id="shop-screen">
            <h1>Ù…ØªØ¬Ø± Ø§Ù„ÙƒØ±Ø§Øª</h1>
            <p>Ø§Ø®ØªØ± ÙƒØ±ØªÙƒ Ø§Ù„ÙØ¶Ø§Ø¦ÙŠØ© Ø§Ù„Ù…ÙØ¶Ù„Ø© Ø¨Ø®ØµØ§Ø¦Øµ Ù…Ø®ØªÙ„ÙØ©!</p>
            
            <div class="shop-items">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>
            
            <button class="btn" id="back-from-shop-btn">Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
        </div>
        
        <div id="levels-screen">
            <h1>Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ù„Ø¹Ø¨Ø©</h1>
            <p>ØªØ­Ø¯Ù‰ Ù†ÙØ³Ùƒ ÙÙŠ Ù…Ø±Ø§Ø­Ù„ Ù…ØªØ¯Ø±Ø¬Ø© Ø§Ù„ØµØ¹ÙˆØ¨Ø©!</p>
            
            <div class="levels-container">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>
            
            <button class="btn" id="back-from-levels-btn">Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
        </div>
        
        <div id="background-select-screen">
            <h1>Ø®Ù„ÙÙŠØ§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©</h1>
            <p>Ø§Ø®ØªØ± Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„ÙØ¶Ø§Ø¦ÙŠØ© Ø§Ù„ØªÙŠ ØªÙØ¶Ù„Ù‡Ø§!</p>
            
            <div class="background-options">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>
            
            <button class="btn" id="back-from-background-btn">Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Ø¹Ù†Ø§ØµØ± DOM
            const canvas = document.getElementById('game-canvas');
            const ctx = canvas.getContext('2d');
            const startScreen = document.getElementById('start-screen');
            const gameOverScreen = document.getElementById('game-over-screen');
            const shopScreen = document.getElementById('shop-screen');
            const levelsScreen = document.getElementById('levels-screen');
            const backgroundScreen = document.getElementById('background-select-screen');
            const startBtn = document.getElementById('start-btn');
            const restartBtn = document.getElementById('restart-btn');
            const backToMenuBtn = document.getElementById('back-to-menu-btn');
            const shopBtn = document.getElementById('shop-btn');
            const backFromShopBtn = document.getElementById('back-from-shop-btn');
            const levelsBtn = document.getElementById('levels-btn');
            const backFromLevelsBtn = document.getElementById('back-from-levels-btn');
            const backgroundBtn = document.getElementById('background-btn');
            const backFromBackgroundBtn = document.getElementById('back-from-background-btn');
            const premiumBtn = document.getElementById('premium-btn');
            const scoreDisplay = document.getElementById('score-display');
            const highScoreDisplay = document.getElementById('high-score-display');
            const coinsDisplay = document.getElementById('coins-display');
            const levelDisplay = document.getElementById('level-display');
            const finalScoreDisplay = document.getElementById('final-score');
            const newHighScoreDisplay = document.getElementById('new-high-score');
            const earnedCoinsDisplay = document.getElementById('earned-coins');
            const shopItemsContainer = document.querySelector('.shop-items');
            const levelsContainer = document.querySelector('.levels-container');
            const backgroundOptionsContainer = document.querySelector('.background-options');
            const uploadBtn = document.getElementById('upload-btn');
            const fileInput = document.getElementById('file-input');
            
            // ØªØ¹ÙŠÙŠÙ† Ø­Ø¬Ù… canvas Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§
            function resizeCanvas() {
                const container = document.getElementById('game-container');
                canvas.width = container.clientWidth;
                canvas.height = container.clientHeight;
            }
            
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();
            
            // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
            let gameRunning = false;
            let score = 0;
            let coins = parseInt(localStorage.getItem('coins')) || 0;
            let highScore = parseInt(localStorage.getItem('highScore')) || 0;
            let currentLevel = parseInt(localStorage.getItem('currentLevel')) || 1;
            let unlockedLevels = JSON.parse(localStorage.getItem('unlockedLevels')) || [1];
            let animationId;
            let gravity = 0.5;
            let speed = 3;
            let obstacleFrequency = 120; // Ø¥Ø·Ø§Ø± Ù„ÙƒÙ„ Ø¹Ù‚Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©
            let frameCount = 0;
            let obstacles = [];
            let particles = [];
            let selectedBallType = localStorage.getItem('selectedBall') || 'default';
            let ownedBalls = JSON.parse(localStorage.getItem('ownedBalls')) || ['default'];
            let currentBackground = localStorage.getItem('gameBackground') || 'default';
            let customBackground = localStorage.getItem('customBackground') || null;
            let backgroundImage = null;
            let backgroundVideo = null;
            let videoElement = null;
            let isPremium = localStorage.getItem('isPremium') === 'true';
            
            // Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ÙƒØ±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„Ø´Ø±Ø§Ø¡
            const ballTypes = {
                'default': {
                    name: 'Ø§Ù„ÙƒØ±Ø© Ø§Ù„ÙØ¶Ø§Ø¦ÙŠØ©',
                    price: 0,
                    color: '#00ffff',
                    radius: 20,
                    jumpForce: -12,
                    description: 'Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¨Ø¯ÙˆÙ† Ù…Ù…ÙŠØ²Ø§Øª Ø®Ø§ØµØ©',
                    owned: true,
                    glowColor: 'rgba(0, 255, 255, 0.5)',
                    premium: false
                },
                'golden': {
                    name: 'Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©',
                    price: 500,
                    color: '#FFD700',
                    radius: 22,
                    jumpForce: -11.5,
                    description: 'ØªØ¬Ù…Ø¹ Ù†Ù‚Ø§Ø· Ø¥Ø¶Ø§ÙÙŠØ© ÙˆØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø¹Ù…Ù„Ø§Øª Ø£ÙƒØ«Ø±!',
                    owned: ownedBalls.includes('golden'),
                    glowColor: 'rgba(255, 215, 0, 0.5)',
                    premium: false
                },
                'bouncy': {
                    name: 'Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ù…Ø±ØªØ¯Ø©',
                    price: 300,
                    color: '#00ffaa',
                    radius: 18,
                    jumpForce: -14,
                    description: 'Ù‚ÙØ²Ø© Ø£Ø¹Ù„Ù‰ Ù…Ø¹ Ø¬Ø§Ø°Ø¨ÙŠØ© Ø£Ù‚Ù„!',
                    owned: ownedBalls.includes('bouncy'),
                    glowColor: 'rgba(0, 255, 170, 0.5)',
                    premium: false
                },
                'heavy': {
                    name: 'Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ø«Ù‚ÙŠÙ„Ø©',
                    price: 200,
                    color: '#aa00ff',
                    radius: 24,
                    jumpForce: -10,
                    description: 'ØªØªØ­Ø±Ùƒ Ø¨Ø¨Ø·Ø¡ ÙˆÙ„ÙƒÙ†Ù‡Ø§ ØªÙ‚Ø§ÙˆÙ… Ø§Ù„Ø±ÙŠØ§Ø­!',
                    owned: ownedBalls.includes('heavy'),
                    glowColor: 'rgba(170, 0, 255, 0.5)',
                    premium: false
                },
                'fire': {
                    name: 'ÙƒØ±Ø© Ø§Ù„Ù†Ø§Ø±',
                    price: 800,
                    color: '#FF4B2B',
                    radius: 21,
                    jumpForce: -12.5,
                    description: 'ØªØ­Ø±Ù‚ Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª Ø§Ù„ØªÙŠ ØªÙ„Ù…Ø³Ù‡Ø§!',
                    owned: ownedBalls.includes('fire'),
                    glowColor: 'rgba(255, 75, 43, 0.5)',
                    premium: false
                },
                'rainbow': {
                    name: 'ÙƒØ±Ø© Ù‚ÙˆØ³ Ù‚Ø²Ø­',
                    price: 1000,
                    color: 'rainbow',
                    radius: 23,
                    jumpForce: -11,
                    description: 'ØªØºÙŠØ± Ù„ÙˆÙ†Ù‡Ø§ Ø¨Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙˆØªØ¬Ø°Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø§Øª!',
                    owned: ownedBalls.includes('rainbow'),
                    glowColor: 'rgba(255, 0, 0, 0.5)',
                    premium: false
                },
                'galactic': {
                    name: 'Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ù…Ø¬Ø±ÙŠØ©',
                    price: 1500,
                    color: 'galactic',
                    radius: 25,
                    jumpForce: -10.5,
                    description: 'ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø¬Ø±Ø© Ù…ØµØºØ±Ø© Ø¨Ø¯Ø§Ø®Ù„Ù‡Ø§!',
                    owned: ownedBalls.includes('galactic'),
                    glowColor: 'rgba(138, 43, 226, 0.5)',
                    premium: true
                },
                'nebula': {
                    name: 'ÙƒØ±Ø© Ø§Ù„Ø³Ø¯ÙŠÙ…',
                    price: 2000,
                    color: 'nebula',
                    radius: 22,
                    jumpForce: -11.5,
                    description: 'ØªØªÙˆÙ‡Ø¬ ÙƒØ³Ø¯ÙŠÙ… ÙØ¶Ø§Ø¦ÙŠ Ø³Ø§Ø­Ø±!',
                    owned: ownedBalls.includes('nebula'),
                    glowColor: 'rgba(75, 0, 130, 0.5)',
                    premium: true
                },
                'blackhole': {
                    name: 'ÙƒØ±Ø© Ø§Ù„Ø«Ù‚Ø¨ Ø§Ù„Ø£Ø³ÙˆØ¯',
                    price: 2500,
                    color: '#000000',
                    radius: 26,
                    jumpForce: -9.5,
                    description: 'ØªÙ…ØªØµ Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª Ø§Ù„Ù‚Ø±ÙŠØ¨Ø© Ù…Ù†Ù‡Ø§!',
                    owned: ownedBalls.includes('blackhole'),
                    glowColor: 'rgba(255, 255, 255, 0.5)',
                    premium: true
                },
                'electric': {
                    name: 'Ø§Ù„ÙƒØ±Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©',
                    price: 1800,
                    color: '#00FFFF',
                    radius: 20,
                    jumpForce: -13,
                    description: 'ØªØµØ¹Ù‚ Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª Ø¨Ø´Ø±Ø§Ø±Ø§Øª ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©!',
                    owned: ownedBalls.includes('electric'),
                    glowColor: 'rgba(0, 255, 255, 0.5)',
                    premium: true
                }
            };
            
            // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…Ø±Ø§Ø­Ù„
            const levels = [
                {
                    level: 1,
                    name: "Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰",
                    difficulty: "Ø³Ù‡Ù„Ø©",
                    description: "Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ù…Ø¹ Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª Ø§Ù„Ø¨Ø³ÙŠØ·Ø©",
                    requiredScore: 0,
                    speed: 3,
                    gravity: 0.5,
                    gap: 180,
                    obstacleColor: "rgba(0, 255, 255, 0.8)",
                    obstacleGlow: "rgba(0, 255, 255, 0.3)"
                },
                {
                    level: 2,
                    name: "Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©",
                    difficulty: "Ù…ØªÙˆØ³Ø·Ø©",
                    description: "Ø¹Ù‚Ø¨Ø§Øª Ø£Ø³Ø±Ø¹ Ù…Ø¹ ÙØ¬ÙˆØ§Øª Ø£ØµØºØ±",
                    requiredScore: 20,
                    speed: 4,
                    gravity: 0.6,
                    gap: 160,
                    obstacleColor: "rgba(0, 170, 255, 0.8)",
                    obstacleGlow: "rgba(0, 170, 255, 0.3)"
                },
                {
                    level: 3,
                    name: "Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©",
                    difficulty: "ØµØ¹Ø¨Ø©",
                    description: "ØªØ­ÙƒÙ… Ø£ÙØ¶Ù„ Ù…Ø¹ Ø¬Ø§Ø°Ø¨ÙŠØ© Ø£Ù‚ÙˆÙ‰",
                    requiredScore: 50,
                    speed: 5,
                    gravity: 0.7,
                    gap: 140,
                    obstacleColor: "rgba(170, 0, 255, 0.8)",
                    obstacleGlow: "rgba(170, 0, 255, 0.3)"
                },
                {
                    level: 4,
                    name: "Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©",
                    difficulty: "Ù…ØªÙ‚Ø¯Ù…Ø©",
                    description: "Ø³Ø±Ø¹Ø© Ø¹Ø§Ù„ÙŠØ© Ù…Ø¹ Ø¹Ù‚Ø¨Ø§Øª Ù…ØªÙ‚Ø§Ø±Ø¨Ø©",
                    requiredScore: 100,
                    speed: 6,
                    gravity: 0.8,
                    gap: 120,
                    obstacleColor: "rgba(255, 0, 170, 0.8)",
                    obstacleGlow: "rgba(255, 0, 170, 0.3)"
                },
                {
                    level: 5,
                    name: "Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø®Ø§Ù…Ø³Ø©",
                    difficulty: "Ø®Ø¨ÙŠØ±",
                    description: "ØªØ­Ø¯ÙŠ Ø­Ù‚ÙŠÙ‚ÙŠ Ù„Ù„Ù…Ø­ØªØ±ÙÙŠÙ† ÙÙ‚Ø·",
                    requiredScore: 200,
                    speed: 7,
                    gravity: 0.9,
                    gap: 100,
                    obstacleColor: "rgba(255, 85, 0, 0.8)",
                    obstacleGlow: "rgba(255, 85, 0, 0.3)"
                },
                {
                    level: 6,
                    name: "Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©",
                    difficulty: "Ø£Ø³Ø·ÙˆØ±ÙŠØ©",
                    description: "Ø£Ù‚ØµÙ‰ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„ØµØ¹ÙˆØ¨Ø© ÙˆØ§Ù„ØªØ­Ø¯ÙŠ",
                    requiredScore: 500,
                    speed: 8,
                    gravity: 1.0,
                    gap: 80,
                    obstacleColor: "rgba(255, 255, 255, 0.8)",
                    obstacleGlow: "rgba(255, 255, 255, 0.3)"
                },
                {
                    level: 7,
                    name: "Ù…Ø±Ø­Ù„Ø© Ø§Ù„ÙØ¶Ø§Ø¡ Ø§Ù„Ø¹Ù…ÙŠÙ‚",
                    difficulty: "Ø®Ø§Ø±Ù‚Ø©",
                    description: "Ø¹Ù‚Ø¨Ø§Øª Ù…ØªØ­Ø±ÙƒØ© Ø¨Ø³Ø±Ø¹Ø§Øª Ù…Ø®ØªÙ„ÙØ©",
                    requiredScore: 800,
                    speed: 9,
                    gravity: 1.1,
                    gap: 70,
                    obstacleColor: "rgba(0, 255, 0, 0.8)",
                    obstacleGlow: "rgba(0, 255, 0, 0.3)"
                },
                {
                    level: 8,
                    name: "Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ù‚Ø¨ Ø§Ù„Ø£Ø³ÙˆØ¯",
                    difficulty: "Ù…Ø³ØªØ­ÙŠÙ„Ø©",
                    description: "Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ© ØªØªØºÙŠØ± Ø¨Ø§Ø³ØªÙ…Ø±Ø§Ø±!",
                    requiredScore: 1200,
                    speed: 10,
                    gravity: 1.2,
                    gap: 60,
                    obstacleColor: "rgba(255, 0, 0, 0.8)",
                    obstacleGlow: "rgba(255, 0, 0, 0.3)"
                },
                {
                    level: 9,
                    name: "Ù…Ø±Ø­Ù„Ø© Ø§Ù„ÙƒÙˆÙ† Ø§Ù„Ù…ØªØ¹Ø¯Ø¯",
                    difficulty: "Ø£Ø³Ø·ÙˆØ±ÙŠØ©+",
                    description: "Ø¹Ù‚Ø¨Ø§Øª ØªØ¸Ù‡Ø± Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª",
                    requiredScore: 2000,
                    speed: 12,
                    gravity: 1.5,
                    gap: 50,
                    obstacleColor: "rgba(255, 255, 0, 0.8)",
                    obstacleGlow: "rgba(255, 255, 0, 0.3)"
                },
                {
                    level: 10,
                    name: "Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø§Ù„Ù…Ø·Ù„Ù‚Ø©",
                    difficulty: "Ø¥Ù„Ù‡ÙŠØ©",
                    description: "Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ù‚Ø§Ø¡ Ø¹Ù„Ù‰ Ù‚ÙŠØ¯ Ø§Ù„Ø­ÙŠØ§Ø©ØŸ",
                    requiredScore: 5000,
                    speed: 15,
                    gravity: 2.0,
                    gap: 40,
                    obstacleColor: "rgba(255, 0, 255, 0.8)",
                    obstacleGlow: "rgba(255, 0, 255, 0.3)"
                }
            ];
            
            // Ø®Ù„ÙÙŠØ§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
            const backgrounds = [
                {
                    id: 'default',
                    name: 'Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„ÙØ¶Ø§Ø¦ÙŠØ©',
                    gradient: ['#000000', '#000033', '#000066'],
                    price: 0,
                    owned: true,
                    premium: false
                },
                {
                    id: 'nebula',
                    name: 'Ø§Ù„Ø³Ø¯ÙŠÙ…',
                    gradient: ['#1a0033', '#4d004d', '#800080'],
                    price: 200,
                    owned: ownedBalls.includes('background_nebula'),
                    premium: false
                },
                {
                    id: 'galaxy',
                    name: 'Ø§Ù„Ù…Ø¬Ø±Ø©',
                    gradient: ['#000033', '#000066', '#000099'],
                    price: 300,
                    owned: ownedBalls.includes('background_galaxy'),
                    premium: false
                },
                {
                    id: 'stars',
                    name: 'Ø§Ù„Ù†Ø¬ÙˆÙ…',
                    gradient: ['#000022', '#001144', '#002266'],
                    price: 250,
                    owned: ownedBalls.includes('background_stars'),
                    premium: false
                },
                {
                    id: 'planet',
                    name: 'Ø§Ù„ÙƒÙˆÙƒØ¨',
                    gradient: ['#003322', '#006644', '#009966'],
                    price: 350,
                    owned: ownedBalls.includes('background_planet'),
                    premium: false
                },
                {
                    id: 'supernova',
                    name: 'Ø§Ù„Ø³ÙˆØ¨Ø±Ù†ÙˆÙØ§',
                    gradient: ['#330000', '#660000', '#990000'],
                    price: 400,
                    owned: ownedBalls.includes('background_supernova'),
                    premium: false
                },
                {
                    id: 'deepspace',
                    name: 'Ø§Ù„ÙØ¶Ø§Ø¡ Ø§Ù„Ø¹Ù…ÙŠÙ‚',
                    gradient: ['#000011', '#000044', '#000077'],
                    price: 600,
                    owned: ownedBalls.includes('background_deepspace'),
                    premium: true
                },
                {
                    id: 'blackhole',
                    name: 'Ø«Ù‚Ø¨ Ø£Ø³ÙˆØ¯',
                    gradient: ['#000000', '#111111', '#333333'],
                    price: 800,
                    owned: ownedBalls.includes('background_blackhole'),
                    premium: true
                },
                {
                    id: 'aurora',
                    name: 'Ø§Ù„Ø£Ø¶ÙˆØ§Ø¡ Ø§Ù„Ù‚Ø·Ø¨ÙŠØ©',
                    gradient: ['#000022', '#003322', '#006633'],
                    price: 700,
                    owned: ownedBalls.includes('background_aurora'),
                    premium: true
                },
                {
                    id: 'cosmic',
                    name: 'Ø§Ù„Ø§Ù†ÙØ¬Ø§Ø± Ø§Ù„ÙƒÙˆÙ†ÙŠ',
                    gradient: ['#220000', '#550000', '#880000'],
                    price: 900,
                    owned: ownedBalls.includes('background_cosmic'),
                    premium: true
                },
                {
                    id: 'milkyway',
                    name: 'Ø¯Ø±Ø¨ Ø§Ù„ØªØ¨Ø§Ù†Ø©',
                    gradient: ['#000033', '#330033', '#660066'],
                    price: 1000,
                    owned: ownedBalls.includes('background_milkyway'),
                    premium: true
                }
            ];
            
            // Ø§Ù„ÙƒØ±Ø©
            const ball = {
                x: canvas.width * 0.2,
                y: canvas.height / 2,
                radius: ballTypes[selectedBallType].radius,
                color: ballTypes[selectedBallType].color,
                glowColor: ballTypes[selectedBallType].glowColor,
                velocityY: 0,
                jumpForce: ballTypes[selectedBallType].jumpForce,
                rainbowHue: 0,
                galacticAngle: 0,
                
                draw() {
                    // ØªØ£Ø«ÙŠØ± Ù‚ÙˆØ³ Ù‚Ø²Ø­ Ù„Ù„ÙƒØ±Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…Ù† Ù†ÙˆØ¹ rainbow
                    let drawColor = this.color;
                    if (this.color === 'rainbow') {
                        this.rainbowHue = (this.rainbowHue + 2) % 360;
                        drawColor = `hsl(${this.rainbowHue}, 100%, 50%)`;
                        this.glowColor = `hsla(${this.rainbowHue}, 100%, 50%, 0.5)`;
                    } else if (this.color === 'galactic') {
                        this.galacticAngle = (this.galacticAngle + 0.01) % (Math.PI * 2);
                    }
                    
                    // Ø±Ø³Ù… ØªØ£Ø«ÙŠØ± Ø§Ù„ØªÙˆÙ‡Ø¬
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius * 1.5, 0, Math.PI * 2);
                    ctx.fillStyle = this.glowColor;
                    ctx.fill();
                    
                    // Ø±Ø³Ù… Ø§Ù„Ø¸Ù„
                    ctx.beginPath();
                    ctx.ellipse(this.x, this.y + this.radius + 5, this.radius * 0.8, this.radius * 0.3, 0, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                    ctx.fill();
                    
                    // Ø±Ø³Ù… Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                    if (this.color === 'galactic') {
                        // Ø±Ø³Ù… Ù…Ø¬Ø±Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒØ±Ø©
                        ctx.save();
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                        ctx.clip();
                        
                        // Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø¬Ø±Ø©
                        const galacticGradient = ctx.createRadialGradient(
                            this.x, this.y, 0,
                            this.x, this.y, this.radius
                        );
                        galacticGradient.addColorStop(0, '#000033');
                        galacticGradient.addColorStop(0.5, '#330066');
                        galacticGradient.addColorStop(1, '#660099');
                        
                        ctx.fillStyle = galacticGradient;
                        ctx.fillRect(this.x - this.radius, this.y - this.radius, this.radius * 2, this.radius * 2);
                        
                        // Ø±Ø³Ù… Ø£Ø°Ø±Ø¹ Ø§Ù„Ù…Ø¬Ø±Ø©
                        for (let i = 0; i < 4; i++) {
                            const angle = this.galacticAngle + (i * Math.PI / 2);
                            ctx.beginPath();
                            ctx.moveTo(this.x, this.y);
                            ctx.lineTo(
                                this.x + Math.cos(angle) * this.radius,
                                this.y + Math.sin(angle) * this.radius
                            );
                            ctx.strokeStyle = 'rgba(255, 255, 255, 0.7)';
                            ctx.lineWidth = 2;
                            ctx.stroke();
                            
                            // Ø§Ù„Ù†Ø¬ÙˆÙ… ÙÙŠ Ø§Ù„Ø£Ø°Ø±Ø¹
                            for (let j = 0.2; j < 1; j += 0.2) {
                                const starX = this.x + Math.cos(angle) * this.radius * j;
                                const starY = this.y + Math.sin(angle) * this.radius * j;
                                ctx.beginPath();
                                ctx.arc(starX, starY, 1 + j, 0, Math.PI * 2);
                                ctx.fillStyle = 'white';
                                ctx.fill();
                            }
                        }
                        
                        // Ø§Ù„Ù†Ø¬ÙˆÙ… ÙÙŠ Ø§Ù„Ù…Ø±ÙƒØ²
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.radius * 0.3, 0, Math.PI * 2);
                        ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                        ctx.fill();
                        
                        ctx.restore();
                    } else if (this.color === 'nebula') {
                        // ØªØ£Ø«ÙŠØ± Ø³Ø¯ÙŠÙ…
                        ctx.save();
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                        ctx.clip();
                        
                        const nebulaGradient = ctx.createRadialGradient(
                            this.x, this.y, 0,
                            this.x, this.y, this.radius
                        );
                        nebulaGradient.addColorStop(0, '#4B0082');
                        nebulaGradient.addColorStop(0.5, '#8A2BE2');
                        nebulaGradient.addColorStop(1, '#9370DB');
                        
                        ctx.fillStyle = nebulaGradient;
                        ctx.fillRect(this.x - this.radius, this.y - this.radius, this.radius * 2, this.radius * 2);
                        
                        // ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø³Ø¯ÙŠÙ…
                        for (let i = 0; i < 10; i++) {
                            const size = Math.random() * this.radius * 0.5 + this.radius * 0.2;
                            const x = this.x + (Math.random() - 0.5) * this.radius * 0.8;
                            const y = this.y + (Math.random() - 0.5) * this.radius * 0.8;
                            
                            const gradient = ctx.createRadialGradient(
                                x, y, 0,
                                x, y, size
                            );
                            gradient.addColorStop(0, `rgba(${Math.floor(Math.random() * 100 + 155)}, ${Math.floor(Math.random() * 100)}, 255, 0.8)`);
                            gradient.addColorStop(1, 'transparent');
                            
                            ctx.beginPath();
                            ctx.arc(x, y, size, 0, Math.PI * 2);
                            ctx.fillStyle = gradient;
                            ctx.fill();
                        }
                        
                        ctx.restore();
                    } else {
                        // Ø±Ø³Ù… Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                        ctx.fillStyle = drawColor;
                        ctx.fill();
                    }
                    
                    ctx.closePath();
                    
                    // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯
                    const gradient = ctx.createRadialGradient(
                        this.x - this.radius/3, 
                        this.y - this.radius/3, 
                        this.radius/4, 
                        this.x, 
                        this.y, 
                        this.radius
                    );
                    gradient.addColorStop(0, 'rgba(255, 255, 255, 0.8)');
                    gradient.addColorStop(0.7, drawColor);
                    gradient.addColorStop(1, shadeColor(drawColor, -30));
                    
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    ctx.fillStyle = gradient;
                    ctx.fill();
                    ctx.closePath();
                    
                    // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯ÙˆØ¯ Ù„Ù„ÙƒØ±Ø©
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                    ctx.closePath();
                    
                    // Ø¥Ø¶Ø§ÙØ© ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„ÙƒØ±Ø©
                    ctx.beginPath();
                    ctx.arc(this.x - this.radius/3, this.y - this.radius/3, this.radius/6, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                    ctx.fill();
                    ctx.closePath();
                    
                    // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„ÙƒØ±Ø©
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                    ctx.lineWidth = 1;
                    ctx.setLineDash([3, 3]);
                    ctx.stroke();
                    ctx.setLineDash([]);
                    ctx.closePath();
                    
                    // ØªØ£Ø«ÙŠØ±Ø§Øª Ø®Ø§ØµØ© Ù„Ù„ÙƒØ±Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©
                    if (selectedBallType === 'electric' && Math.random() > 0.9) {
                        const points = [];
                        for (let i = 0; i < 10; i++) {
                            const angle = Math.random() * Math.PI * 2;
                            const dist = this.radius + Math.random() * 15;
                            points.push({
                                x: this.x + Math.cos(angle) * dist,
                                y: this.y + Math.sin(angle) * dist
                            });
                        }
                        
                        ctx.strokeStyle = '#00FFFF';
                        ctx.lineWidth = 1;
                        ctx.beginPath();
                        ctx.moveTo(points[0].x, points[0].y);
                        
                        for (let i = 1; i < points.length; i++) {
                            const midX = (points[i].x + points[i-1].x) / 2;
                            const midY = (points[i].y + points[i-1].y) / 2;
                            ctx.quadraticCurveTo(
                                midX + (Math.random() - 0.5) * 10,
                                midY + (Math.random() - 0.5) * 10,
                                points[i].x, points[i].y
                            );
                        }
                        
                        ctx.stroke();
                    }
                },
                
                update() {
                    this.velocityY += gravity;
                    this.y += this.velocityY;
                    
                    // Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ù„ÙˆÙŠØ© ÙˆØ§Ù„Ø³ÙÙ„ÙŠØ©
                    if (this.y + this.radius > canvas.height) {
                        this.y = canvas.height - this.radius;
                        this.velocityY = 0;
                        createParticles(this.x, this.y + this.radius, 10, this.color === 'rainbow' ? `hsl(${this.rainbowHue}, 100%, 50%)` : this.color);
                    } else if (this.y - this.radius < 0) {
                        this.y = this.radius;
                        this.velocityY = 0;
                    }
                    
                    // ØªØ£Ø«ÙŠØ± Ø§Ù„Ø«Ù‚Ø¨ Ø§Ù„Ø£Ø³ÙˆØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª Ø§Ù„Ù‚Ø±ÙŠØ¨Ø©
                    if (selectedBallType === 'blackhole') {
                        for (let i = 0; i < obstacles.length; i++) {
                            const obstacle = obstacles[i];
                            const dx = (obstacle.x + obstacle.width/2) - this.x;
                            const dy = (obstacle.topHeight + obstacle.gap/2) - this.y;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            
                            if (distance < 150) { // Ù…Ø³Ø§ÙØ© Ø§Ù„Ø¬Ø°Ø¨
                                const force = 150 / (distance * distance);
                                obstacle.x -= dx * force * 0.1;
                                
                                // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¹Ù‚Ø¨Ø© Ù‚Ø±ÙŠØ¨Ø© Ø¬Ø¯Ù‹Ø§ØŒ ØªØ®ØªÙÙŠ
                                if (distance < 30) {
                                    createParticles(obstacle.x + obstacle.width/2, obstacle.topHeight + obstacle.gap/2, 20, '#FFFFFF');
                                    obstacles.splice(i, 1);
                                    i--;
                                }
                            }
                        }
                    }
                },
                
                jump() {
                    this.velocityY = this.jumpForce;
                    createParticles(this.x, this.y - this.radius, 5, '#FFFFFF');
                    
                    // ØªØ£Ø«ÙŠØ±Ø§Øª Ø®Ø§ØµØ© Ø¹Ù†Ø¯ Ø§Ù„Ù‚ÙØ²
                    if (selectedBallType === 'electric') {
                        for (let i = 0; i < 5; i++) {
                            const angle = Math.random() * Math.PI * 2;
                            const dist = this.radius + Math.random() * 20;
                            createParticles(
                                this.x + Math.cos(angle) * dist,
                                this.y + Math.sin(angle) * dist,
                                3, '#00FFFF'
                            );
                        }
                    }
                }
            };
            
            // Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª
            class Obstacle {
                constructor() {
                    this.width = 40;
                    this.gap = levels[currentLevel-1].gap;
                    this.x = canvas.width;
                    this.topHeight = Math.random() * (canvas.height - this.gap - 100) + 50;
                    this.bottomY = this.topHeight + this.gap;
                    this.color = levels[currentLevel-1].obstacleColor;
                    this.glowColor = levels[currentLevel-1].obstacleGlow;
                    this.passed = false;
                    this.hasCoin = Math.random() > 0.7; // 30% ÙØ±ØµØ© Ù„ÙˆØ¬ÙˆØ¯ Ø¹Ù…Ù„Ø©
                    this.coinY = this.topHeight + this.gap/2;
                    this.coinCollected = false;
                    
                    // ÙÙŠ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©ØŒ Ù‚Ø¯ ØªØªØ­Ø±Ùƒ Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª Ù„Ø£Ø¹Ù„Ù‰ ÙˆÙ„Ø£Ø³ÙÙ„
                    if (currentLevel >= 7) {
                        this.moving = Math.random() > 0.5;
                        this.moveDirection = Math.random() > 0.5 ? 1 : -1;
                        this.moveSpeed = Math.random() * 2 + 1;
                    } else {
                        this.moving = false;
                    }
                }
                
                draw() {
                    // ØªØ£Ø«ÙŠØ± Ø§Ù„ØªÙˆÙ‡Ø¬ Ù„Ù„Ø¹Ù‚Ø¨Ø§Øª
                    ctx.beginPath();
                    ctx.rect(this.x - 5, 0, this.width + 10, this.topHeight);
                    ctx.rect(this.x - 5, this.bottomY, this.width + 10, canvas.height - this.bottomY);
                    ctx.fillStyle = this.glowColor;
                    ctx.fill();
                    
                    // Ø§Ù„Ø¹Ù‚Ø¨Ø© Ø§Ù„Ø¹Ù„ÙˆÙŠØ© Ù…Ø¹ ØªØ£Ø«ÙŠØ± Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯
                    const topGradient = ctx.createLinearGradient(this.x, 0, this.x + this.width, 0);
                    topGradient.addColorStop(0, shadeColor(this.color, -20));
                    topGradient.addColorStop(0.5, this.color);
                    topGradient.addColorStop(1, shadeColor(this.color, -20));
                    
                    ctx.fillStyle = topGradient;
                    ctx.fillRect(this.x, 0, this.width, this.topHeight);
                    
                    // Ø§Ù„Ø¹Ù‚Ø¨Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ© Ù…Ø¹ ØªØ£Ø«ÙŠØ± Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯
                    const bottomGradient = ctx.createLinearGradient(this.x, this.bottomY, this.x + this.width, this.bottomY);
                    bottomGradient.addColorStop(0, shadeColor(this.color, -20));
                    bottomGradient.addColorStop(0.5, this.color);
                    bottomGradient.addColorStop(1, shadeColor(this.color, -20));
                    
                    ctx.fillStyle = bottomGradient;
                    ctx.fillRect(this.x, this.bottomY, this.width, canvas.height - this.bottomY);
                    
                    // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯ÙˆØ¯ ÙˆØªÙØ§ØµÙŠÙ„ Ø«Ù„Ø§Ø«ÙŠØ© Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯
                    ctx.strokeStyle = 'rgba(0, 0, 0, 0.5)';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(this.x, 0, this.width, this.topHeight);
                    ctx.strokeRect(this.x, this.bottomY, this.width, canvas.height - this.bottomY);
                    
                    // Ø¥Ø¶Ø§ÙØ© Ø®Ø·ÙˆØ· Ø£ÙÙ‚ÙŠØ© Ù„Ù„Ø¹Ù…Ù‚
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
                    ctx.lineWidth = 1;
                    for (let y = 10; y < this.topHeight; y += 15) {
                        ctx.beginPath();
                        ctx.moveTo(this.x, y);
                        ctx.lineTo(this.x + this.width, y);
                        ctx.stroke();
                    }
                    
                    for (let y = this.bottomY + 10; y < canvas.height; y += 15) {
                        ctx.beginPath();
                        ctx.moveTo(this.x, y);
                        ctx.lineTo(this.x + this.width, y);
                        ctx.stroke();
                    }
                    
                    // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ©
                    ctx.strokeStyle = 'rgba(0, 255, 255, 0.5)';
                    ctx.setLineDash([5, 3]);
                    ctx.lineWidth = 1;
                    ctx.strokeRect(this.x + 5, 5, this.width - 10, this.topHeight - 10);
                    ctx.strokeRect(this.x + 5, this.bottomY + 5, this.width - 10, canvas.height - this.bottomY - 10);
                    ctx.setLineDash([]);
                    
                    // Ø±Ø³Ù… Ø§Ù„Ø¹Ù…Ù„Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø© ÙˆÙ„Ù… ÙŠØªÙ… Ø¬Ù…Ø¹Ù‡Ø§
                    if (this.hasCoin && !this.coinCollected && this.x + this.width > 0) {
                        // ØªØ£Ø«ÙŠØ± Ø§Ù„ØªÙˆÙ‡Ø¬ Ù„Ù„Ø¹Ù…Ù„Ø©
                        ctx.beginPath();
                        ctx.arc(this.x + this.width/2, this.coinY, 15, 0, Math.PI * 2);
                        ctx.fillStyle = 'rgba(255, 215, 0, 0.3)';
                        ctx.fill();
                        
                        // Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©
                        const coinGradient = ctx.createRadialGradient(
                            this.x + this.width/2 - 5, 
                            this.coinY - 5, 
                            2, 
                            this.x + this.width/2, 
                            this.coinY, 
                            10
                        );
                        coinGradient.addColorStop(0, '#FFD700');
                        coinGradient.addColorStop(0.5, '#FFCC00');
                        coinGradient.addColorStop(1, '#FFAA00');
                        
                        ctx.beginPath();
                        ctx.arc(this.x + this.width/2, this.coinY, 10, 0, Math.PI * 2);
                        ctx.fillStyle = coinGradient;
                        ctx.fill();
                        
                        ctx.beginPath();
                        ctx.arc(this.x + this.width/2, this.coinY, 10, 0, Math.PI * 2);
                        ctx.strokeStyle = 'rgba(0, 0, 0, 0.5)';
                        ctx.lineWidth = 2;
                        ctx.stroke();
                        
                        ctx.font = 'bold 12px Arial';
                        ctx.fillStyle = 'black';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillText('$', this.x + this.width/2, this.coinY);
                    }
                }
                
                update() {
                    this.x -= speed;
                    
                    // Ø­Ø±ÙƒØ© Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª Ù„Ø£Ø¹Ù„Ù‰ ÙˆÙ„Ø£Ø³ÙÙ„ ÙÙŠ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
                    if (this.moving) {
                        if (currentLevel >= 8) {
                            // ÙÙŠ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 8 ÙÙ…Ø§ ÙÙˆÙ‚ØŒ ØªØªØºÙŠØ± Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠØ§Ù‹
                            if (Math.random() > 0.98) {
                                this.moveDirection *= -1;
                            }
                        }
                        
                        this.topHeight += this.moveDirection * this.moveSpeed;
                        this.bottomY = this.topHeight + this.gap;
                        
                        // ØªØºÙŠÙŠØ± Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­ÙˆØ§Ù
                        if (this.topHeight < 20 || this.bottomY > canvas.height - 20) {
                            this.moveDirection *= -1;
                        }
                        
                        if (this.hasCoin && !this.coinCollected) {
                            this.coinY = this.topHeight + this.gap/2;
                        }
                    }
                    
                    // Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø§ØµØ·Ø¯Ø§Ù…
                    if (
                        ball.x + ball.radius > this.x && 
                        ball.x - ball.radius < this.x + this.width && 
                        (ball.y - ball.radius < this.topHeight || ball.y + ball.radius > this.bottomY)
                    ) {
                        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ÙƒØ±Ø© Ø§Ù„Ù†Ø§Ø± ØªØ­Ø±Ù‚ Ø§Ù„Ø¹Ù‚Ø¨Ø©
                        if (selectedBallType === 'fire' && Math.random() > 0.7) {
                            createParticles(this.x + this.width/2, this.topHeight + this.gap/2, 20, '#FF4B2B');
                            obstacles.splice(obstacles.indexOf(this), 1);
                        } 
                        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ÙƒØ±Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ© ØªØµØ¹Ù‚ Ø§Ù„Ø¹Ù‚Ø¨Ø©
                        else if (selectedBallType === 'electric' && Math.random() > 0.5) {
                            createParticles(this.x + this.width/2, this.topHeight + this.gap/2, 15, '#00FFFF');
                            obstacles.splice(obstacles.indexOf(this), 1);
                        } else {
                            gameOver();
                        }
                    }
                    
                    // Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ù…Ù„Ø©
                    if (this.hasCoin && !this.coinCollected && 
                        ball.x + ball.radius > this.x && 
                        ball.x - ball.radius < this.x + this.width && 
                        ball.y > this.topHeight && ball.y < this.bottomY) {
                        this.coinCollected = true;
                        let coinsEarned = 1;
                        
                        // Ù…ÙƒØ§ÙØ¢Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„ÙƒØ±Ø§Øª Ø§Ù„Ø®Ø§ØµØ©
                        if (selectedBallType === 'golden' || selectedBallType === 'rainbow') coinsEarned = 2;
                        if (selectedBallType === 'galactic') coinsEarned = 3;
                        
                        coins += coinsEarned;
                        coinsDisplay.textContent = `Ø§Ù„Ø¹Ù…Ù„Ø§Øª: ${coins}`;
                        createParticles(this.x + this.width/2, this.coinY, 15, '#FFD700');
                    }
                    
                    // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù†Ù‚Ø§Ø· Ø¹Ù†Ø¯ ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø¹Ù‚Ø¨Ø©
                    if (!this.passed && ball.x > this.x + this.width) {
                        this.passed = true;
                        let pointsEarned = 1;
                        
                        // Ù…ÙƒØ§ÙØ¢Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„ÙƒØ±Ø§Øª Ø§Ù„Ø®Ø§ØµØ©
                        if (selectedBallType === 'golden') pointsEarned = 2;
                        if (selectedBallType === 'galactic') pointsEarned = 3;
                        
                        score += pointsEarned;
                        scoreDisplay.textContent = `Ø§Ù„Ù†Ù‚Ø§Ø·: ${score}`;
                        createParticles(this.x + this.width/2, this.topHeight + this.gap/2, 15, '#FFD700');
                    }
                }
            }
            
            // Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª Ù„Ù„ØªØ£Ø«ÙŠØ±Ø§Øª
            class Particle {
                constructor(x, y, color) {
                    this.x = x;
                    this.y = y;
                    this.size = Math.random() * 5 + 2;
                    this.color = color;
                    this.velocityX = Math.random() * 6 - 3;
                    this.velocityY = Math.random() * 6 - 3;
                    this.alpha = 1;
                    this.decay = Math.random() * 0.05 + 0.01;
                    this.gravity = 0.1;
                }
                
                draw() {
                    ctx.save();
                    ctx.globalAlpha = this.alpha;
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Ø¥Ø¶Ø§ÙØ© ØªÙˆÙ‡Ø¬ Ù„Ù„Ø¬Ø³ÙŠÙ…Ø§Øª
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size * 1.5, 0, Math.PI * 2);
                    ctx.fillStyle = this.color.replace(')', ', 0.3)').replace('rgb', 'rgba');
                    ctx.fill();
                    ctx.restore();
                }
                
                update() {
                    this.x += this.velocityX;
                    this.y += this.velocityY;
                    this.velocityY += this.gravity;
                    this.alpha -= this.decay;
                }
            }
            
            // ÙˆØ¸ÙŠÙØ© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ø¸Ù„
            function shadeColor(color, percent) {
                if (color.includes('hsl')) return color;
                if (color.includes('rgba')) {
                    const parts = color.match(/rgba\((\d+),\s*(\d+),\s*(\d+),\s*([\d.]+)\)/);
                    if (!parts) return color;
                    
                    let r = parseInt(parts[1]);
                    let g = parseInt(parts[2]);
                    let b = parseInt(parts[3]);
                    const a = parseFloat(parts[4]);
                    
                    r = parseInt(r * (100 + percent) / 100);
                    g = parseInt(g * (100 + percent) / 100);
                    b = parseInt(b * (100 + percent) / 100);
                    
                    r = Math.min(255, Math.max(0, r));
                    g = Math.min(255, Math.max(0, g));
                    b = Math.min(255, Math.max(0, b));
                    
                    return `rgba(${r}, ${g}, ${b}, ${a})`;
                }
                
                let R = parseInt(color.substring(1,3), 16);
                let G = parseInt(color.substring(3,5), 16);
                let B = parseInt(color.substring(5,7), 16);

                R = parseInt(R * (100 + percent) / 100);
                G = parseInt(G * (100 + percent) / 100);
                B = parseInt(B * (100 + percent) / 100);

                R = (R<255)?R:255;  
                G = (G<255)?G:255;  
                B = (B<255)?B:255;  

                R = Math.round(R);
                G = Math.round(G);
                B = Math.round(B);

                const RR = ((R.toString(16).length==1)?"0"+R.toString(16):R.toString(16));
                const GG = ((G.toString(16).length==1)?"0"+G.toString(16):G.toString(16));
                const BB = ((B.toString(16).length==1)?"0"+B.toString(16):B.toString(16));

                return "#"+RR+GG+BB;
            }
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø³ÙŠÙ…Ø§Øª Ù„Ù„ØªØ£Ø«ÙŠØ±Ø§Øª
            function createParticles(x, y, count, color) {
                for (let i = 0; i < count; i++) {
                    particles.push(new Particle(x, y, color));
                }
            }
            
            // Ø±Ø³Ù… Ø®Ù„ÙÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©
            function drawBackground() {
                // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ø®Ù„ÙÙŠØ© Ù…Ø®ØµØµØ©
                if (currentBackground === 'custom' && (backgroundImage || backgroundVideo)) {
                    if (backgroundVideo && videoElement) {
                        // Ø±Ø³Ù… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙƒØ®Ù„ÙÙŠØ©
                        ctx.globalAlpha = 0.7;
                        ctx.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
                        ctx.globalAlpha = 1.0;
                    } else if (backgroundImage) {
                        // Ø±Ø³Ù… Ø§Ù„ØµÙˆØ±Ø© ÙƒØ®Ù„ÙÙŠØ©
                        ctx.globalAlpha = 0.7;
                        ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
                        ctx.globalAlpha = 1.0;
                    }
                    
                    // Ø¥Ø¶Ø§ÙØ© Ø·Ø¨Ù‚Ø© Ø¯Ø§ÙƒÙ†Ø© ÙÙˆÙ‚ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø®ØµØµØ©
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                } else {
                    // Ø®Ù„ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                    const bg = backgrounds.find(b => b.id === currentBackground) || backgrounds[0];
                    
                    // Ø®Ù„ÙÙŠØ© Ù…ØªØ¯Ø±Ø¬Ø©
                    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
                    gradient.addColorStop(0, bg.gradient[0]);
                    gradient.addColorStop(0.5, bg.gradient[1]);
                    gradient.addColorStop(1, bg.gradient[2]);
                    ctx.fillStyle = gradient;
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }
                
                // Ø¥Ø¶Ø§ÙØ© Ù†Ø¬ÙˆÙ… ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                for (let i = 0; i < 100; i++) {
                    if (i % 10 === 0) { // ÙƒÙ„ 10 Ø¥Ø·Ø§Ø±Ø§Øª Ù†Ø­Ø±Ùƒ Ø§Ù„Ù†Ø¬ÙˆÙ…
                        const starX = Math.random() * canvas.width;
                        const starY = Math.random() * canvas.height;
                        const starSize = Math.random() * 2 + 1;
                        
                        ctx.beginPath();
                        ctx.arc(starX, starY, starSize, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
                
                // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ© Ù„Ù„Ø®Ù„ÙÙŠØ©
                ctx.strokeStyle = 'rgba(0, 255, 255, 0.1)';
                ctx.lineWidth = 1;
                
                // Ø®Ø·ÙˆØ· Ø£ÙÙ‚ÙŠØ©
                for (let y = 0; y < canvas.height; y += 50) {
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(canvas.width, y);
                    ctx.stroke();
                }
                
                // Ø®Ø·ÙˆØ· Ø¹Ù…ÙˆØ¯ÙŠØ©
                for (let x = 0; x < canvas.width; x += 50) {
                    ctx.beginPath();
                    ctx.moveTo(x, 0);
                    ctx.lineTo(x, canvas.height);
                    ctx.stroke();
                }
                
                // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø´Ø¨ÙƒØ© ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ©
                ctx.strokeStyle = 'rgba(0, 255, 255, 0.05)';
                ctx.setLineDash([5, 5]);
                for (let y = 0; y < canvas.height; y += 20) {
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(canvas.width, y);
                    ctx.stroke();
                }
                for (let x = 0; x < canvas.width; x += 20) {
                    ctx.beginPath();
                    ctx.moveTo(x, 0);
                    ctx.lineTo(x, canvas.height);
                    ctx.stroke();
                }
                ctx.setLineDash([]);
                
                // ØªØ£Ø«ÙŠØ±Ø§Øª Ø®Ø§ØµØ© Ù„Ù„Ø®Ù„ÙÙŠØ§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø©
                if (currentBackground === 'deepspace') {
                    // Ø¥Ø¶Ø§ÙØ© Ù…Ø¬Ø±Ø§Øª Ø¨Ø¹ÙŠØ¯Ø©
                    for (let i = 0; i < 3; i++) {
                        const galaxyX = (frameCount * 0.1 + i * 1000) % (canvas.width + 200) - 100;
                        const galaxyY = 50 + i * 150;
                        const size = 30 + i * 10;
                        
                        ctx.beginPath();
                        ctx.arc(galaxyX, galaxyY, size, 0, Math.PI * 2);
                        ctx.fillStyle = `rgba(${50 + i * 50}, ${50 + i * 30}, ${150 + i * 50}, 0.3)`;
                        ctx.fill();
                    }
                } else if (currentBackground === 'aurora') {
                    // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø§Ù„Ø£Ø¶ÙˆØ§Ø¡ Ø§Ù„Ù‚Ø·Ø¨ÙŠØ©
                    for (let i = 0; i < 3; i++) {
                        const waveHeight = 50 + i * 30;
                        const waveY = canvas.height / 3 + i * 50;
                        
                        ctx.beginPath();
                        ctx.moveTo(0, waveY);
                        
                        for (let x = 0; x < canvas.width; x += 20) {
                            const y = waveY + Math.sin(x * 0.02 + frameCount * 0.02 + i) * waveHeight;
                            ctx.lineTo(x, y);
                        }
                        
                        ctx.lineTo(canvas.width, canvas.height);
                        ctx.lineTo(0, canvas.height);
                        ctx.closePath();
                        
                        const gradient = ctx.createLinearGradient(0, waveY, 0, waveY + waveHeight * 2);
                        gradient.addColorStop(0, `rgba(0, ${150 + i * 50}, ${100 + i * 50}, 0.3)`);
                        gradient.addColorStop(1, 'transparent');
                        
                        ctx.fillStyle = gradient;
                        ctx.fill();
                    }
                }
            }
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ¬Ø±
            function renderShop() {
                shopItemsContainer.innerHTML = '';
                
                for (const [type, ball] of Object.entries(ballTypes)) {
                    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙƒØ±Ø§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø© Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…Ù…ÙŠØ²Ø§Ù‹
                    if (ball.premium && !isPremium) continue;
                    
                    const itemEl = document.createElement('div');
                    itemEl.className = 'shop-item';
                    
                    const ballPreview = document.createElement('div');
                    ballPreview.className = 'ball-preview';
                    
                    if (type === 'rainbow') {
                        ballPreview.style.background = 'linear-gradient(45deg, red, orange, yellow, green, blue, indigo, violet)';
                    } else if (type === 'galactic') {
                        ballPreview.style.background = 'radial-gradient(circle, #000033, #330066, #660099)';
                    } else if (type === 'nebula') {
                        ballPreview.style.background = 'radial-gradient(circle, #4B0082, #8A2BE2, #9370DB)';
                    } else {
                        ballPreview.style.background = ball.color;
                    }
                    
                    ballPreview.style.color = ball.color;
                    
                    const itemInfo = document.createElement('div');
                    itemInfo.className = 'item-info';
                    
                    const itemName = document.createElement('div');
                    itemName.className = 'item-name';
                    itemName.textContent = ball.name;
                    
                    const itemPrice = document.createElement('div');
                    itemPrice.className = 'item-price';
                    itemPrice.textContent = `Ø§Ù„Ø³Ø¹Ø±: ${ball.price} Ø¹Ù…Ù„Ø©`;
                    
                    const itemDesc = document.createElement('div');
                    itemDesc.className = 'item-description';
                    itemDesc.textContent = ball.description;
                    
                    itemInfo.appendChild(itemName);
                    itemInfo.appendChild(itemPrice);
                    itemInfo.appendChild(itemDesc);
                    
                    const buyBtn = document.createElement('button');
                    buyBtn.className = 'buy-btn';
                    
                    if (ball.owned) {
                        if (selectedBallType === type) {
                            buyBtn.textContent = 'Ù…Ø­Ø¯Ø¯Ø©';
                            buyBtn.disabled = true;
                        } else {
                            buyBtn.textContent = 'Ø§Ø®ØªØ±';
                            buyBtn.onclick = () => selectBall(type);
                        }
                    } else {
                        buyBtn.textContent = 'Ø´Ø±Ø§Ø¡';
                        buyBtn.disabled = coins < ball.price;
                        buyBtn.onclick = () => purchaseBall(type, ball.price);
                    }
                    
                    itemEl.appendChild(ballPreview);
                    itemEl.appendChild(itemInfo);
                    itemEl.appendChild(buyBtn);
                    
                    if (ball.owned && selectedBallType === type) {
                        const ownedBadge = document.createElement('div');
                        ownedBadge.className = 'owned-badge';
                        ownedBadge.textContent = 'Ù…Ø­Ø¯Ø¯Ø©';
                        itemEl.appendChild(ownedBadge);
                    } else if (ball.owned) {
                        const ownedBadge = document.createElement('div');
                        ownedBadge.className = 'owned-badge';
                        ownedBadge.textContent = 'Ù…Ù…Ù„ÙˆÙƒØ©';
                        itemEl.appendChild(ownedBadge);
                    }
                    
                    if (ball.premium) {
                        const premiumBadge = document.createElement('div');
                        premiumBadge.className = 'premium-badge';
                        premiumBadge.textContent = 'Ù…Ù…ÙŠØ²Ø©';
                        itemEl.appendChild(premiumBadge);
                    }
                    
                    shopItemsContainer.appendChild(itemEl);
                }
            }
            
            // Ø´Ø±Ø§Ø¡ ÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©
            function purchaseBall(type, price) {
                if (coins >= price) {
                    coins -= price;
                    coinsDisplay.textContent = `Ø§Ù„Ø¹Ù…Ù„Ø§Øª: ${coins}`;
                    localStorage.setItem('coins', coins);
                    
                    ballTypes[type].owned = true;
                    ownedBalls.push(type);
                    localStorage.setItem('ownedBalls', JSON.stringify(ownedBalls));
                    
                    renderShop();
                }
            }
            
            // Ø§Ø®ØªÙŠØ§Ø± ÙƒØ±Ø© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
            function selectBall(type) {
                selectedBallType = type;
                localStorage.setItem('selectedBall', type);
                
                // ØªØ­Ø¯ÙŠØ« Ø®ØµØ§Ø¦Øµ Ø§Ù„ÙƒØ±Ø©
                ball.radius = ballTypes[type].radius;
                ball.color = ballTypes[type].color;
                ball.glowColor = ballTypes[type].glowColor;
                ball.jumpForce = ballTypes[type].jumpForce;
                
                renderShop();
            }
            
            // Ø¹Ø±Ø¶ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø®Ù„ÙÙŠØ©
            function renderBackgroundOptions() {
                backgroundOptionsContainer.innerHTML = '';
                
                // Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø± Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø®ØµØµØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
                if (customBackground) {
                    const customBgEl = document.createElement('div');
                    customBgEl.className = 'background-option';
                    customBgEl.style.border = currentBackground === 'custom' ? '2px solid #00ffff' : '1px solid rgba(0, 255, 255, 0.3)';
                    
                    const customPreview = document.createElement('div');
                    customPreview.className = 'background-preview';
                    customPreview.style.backgroundImage = `url(${customBackground})`;
                    customPreview.style.backgroundSize = 'cover';
                    
                    const customName = document.createElement('div');
                    customName.className = 'background-name';
                    customName.textContent = 'Ø®Ù„ÙÙŠØªÙƒ Ø§Ù„Ù…Ø®ØµØµØ©';
                    
                    customBgEl.appendChild(customPreview);
                    customBgEl.appendChild(customName);
                    
                    if (currentBackground === 'custom') {
                        customBgEl.style.boxShadow = '0 0 15px rgba(0, 255, 255, 0.5)';
                    } else {
                        customBgEl.onclick = () => selectBackground('custom');
                    }
                    
                    backgroundOptionsContainer.appendChild(customBgEl);
                }
                
                backgrounds.forEach(bg => {
                    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø®Ù„ÙÙŠØ§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø© Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…Ù…ÙŠØ²Ø§Ù‹
                    if (bg.premium && !isPremium) return;
                    
                    const bgEl = document.createElement('div');
                    bgEl.className = 'background-option';
                    
                    const bgPreview = document.createElement('div');
                    bgPreview.className = 'background-preview';
                    bgPreview.style.background = `linear-gradient(to bottom, ${bg.gradient.join(', ')})`;
                    
                    const bgName = document.createElement('div');
                    bgName.className = 'background-name';
                    bgName.textContent = bg.name;
                    
                    bgEl.appendChild(bgPreview);
                    bgEl.appendChild(bgName);
                    
                    if (bg.owned) {
                        if (currentBackground === bg.id) {
                            bgEl.style.border = '2px solid #00ffff';
                            bgEl.style.boxShadow = '0 0 15px rgba(0, 255, 255, 0.5)';
                        } else {
                            bgEl.onclick = () => selectBackground(bg.id);
                        }
                    } else {
                        const bgPrice = document.createElement('div');
                        bgPrice.className = 'item-price';
                        bgPrice.textContent = `${bg.price} Ø¹Ù…Ù„Ø©`;
                        bgEl.appendChild(bgPrice);
                        
                        const buyBtn = document.createElement('button');
                        buyBtn.className = 'buy-btn';
                        buyBtn.textContent = 'Ø´Ø±Ø§Ø¡';
                        buyBtn.disabled = coins < bg.price;
                        buyBtn.onclick = () => purchaseBackground(bg.id, bg.price);
                        bgEl.appendChild(buyBtn);
                    }
                    
                    if (bg.premium) {
                        const premiumBadge = document.createElement('div');
                        premiumBadge.className = 'premium-badge';
                        premiumBadge.textContent = 'Ù…Ù…ÙŠØ²Ø©';
                        bgEl.appendChild(premiumBadge);
                    }
                    
                    backgroundOptionsContainer.appendChild(bgEl);
                });
            }
            
            // Ø´Ø±Ø§Ø¡ Ø®Ù„ÙÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©
            function purchaseBackground(id, price) {
                if (coins >= price) {
                    coins -= price;
                    coinsDisplay.textContent = `Ø§Ù„Ø¹Ù…Ù„Ø§Øª: ${coins}`;
                    localStorage.setItem('coins', coins);
                    
                    const bg = backgrounds.find(b => b.id === id);
                    if (bg) bg.owned = true;
                    
                    localStorage.setItem(`background_${id}`, 'owned');
                    renderBackgroundOptions();
                }
            }
            
            // Ø§Ø®ØªÙŠØ§Ø± Ø®Ù„ÙÙŠØ© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
            function selectBackground(id) {
                currentBackground = id;
                localStorage.setItem('gameBackground', id);
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø®ØµØµØ©ØŒ ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·
                if (id === 'custom') {
                    if (customBackground) {
                        if (customBackground.endsWith('.mp4') || customBackground.endsWith('.webm')) {
                            loadVideoBackground(customBackground);
                        } else {
                            loadImageBackground(customBackground);
                        }
                    }
                } else {
                    // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ ÙÙŠØ¯ÙŠÙˆ ÙŠØ¹Ù…Ù„ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ ÙˆØ§Ø­Ø¯
                    if (videoElement) {
                        videoElement.pause();
                        videoElement = null;
                    }
                    backgroundImage = null;
                }
                
                renderBackgroundOptions();
            }
            
            // ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©
            function loadImageBackground(imageUrl) {
                backgroundImage = new Image();
                backgroundImage.src = imageUrl;
                backgroundImage.onload = () => {
                    if (videoElement) {
                        videoElement.pause();
                        videoElement = null;
                    }
                };
            }
            
            // ØªØ­Ù…ÙŠÙ„ ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø®Ù„ÙÙŠØ©
            function loadVideoBackground(videoUrl) {
                if (videoElement) {
                    videoElement.pause();
                }
                
                videoElement = document.createElement('video');
                videoElement.src = videoUrl;
                videoElement.loop = true;
                videoElement.muted = true;
                videoElement.playsInline = true;
                videoElement.style.display = 'none';
                document.body.appendChild(videoElement);
                
                videoElement.play().catch(e => console.error('Error playing video:', e));
                
                backgroundImage = null;
            }
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø±Ø§Ø­Ù„
            function renderLevels() {
                levelsContainer.innerHTML = '';
                
                levels.forEach(level => {
                    const levelEl = document.createElement('div');
                    levelEl.className = `level-card ${unlockedLevels.includes(level.level) ? 'unlocked' : 'locked'}`;
                    
                    const levelNumber = document.createElement('div');
                    levelNumber.className = 'level-number';
                    levelNumber.textContent = `Ø§Ù„Ù…Ø±Ø­Ù„Ø© ${level.level}`;
                    
                    const levelName = document.createElement('div');
                    levelName.className = 'item-name';
                    levelName.textContent = level.name;
                    
                    const levelDiff = document.createElement('div');
                    levelDiff.className = 'level-difficulty';
                    levelDiff.textContent = `Ø§Ù„ØµØ¹ÙˆØ¨Ø©: ${level.difficulty}`;
                    
                    const levelDesc = document.createElement('div');
                    levelDesc.className = 'item-description';
                    levelDesc.textContent = level.description;
                    
                    levelEl.appendChild(levelNumber);
                    levelEl.appendChild(levelName);
                    levelEl.appendChild(levelDiff);
                    levelEl.appendChild(levelDesc);
                    
                    if (!unlockedLevels.includes(level.level)) {
                        const lockIcon = document.createElement('div');
                        lockIcon.className = 'lock-icon';
                        lockIcon.innerHTML = 'ğŸ”’';
                        
                        const reqText = document.createElement('div');
                        reqText.className = 'level-requirements';
                        reqText.textContent = `ØªØªØ·Ù„Ø¨ ${level.requiredScore} Ù†Ù‚Ø·Ø©`;
                        
                        levelEl.appendChild(lockIcon);
                        levelEl.appendChild(reqText);
                    } else {
                        levelEl.onclick = () => selectLevel(level.level);
                        
                        if (currentLevel === level.level) {
                            levelEl.style.border = '2px solid #00ffff';
                            levelEl.style.boxShadow = '0 0 15px rgba(0, 255, 255, 0.5)';
                        }
                    }
                    
                    levelsContainer.appendChild(levelEl);
                });
            }
            
            // Ø§Ø®ØªÙŠØ§Ø± Ù…Ø±Ø­Ù„Ø©
            function selectLevel(level) {
                currentLevel = level;
                localStorage.setItem('currentLevel', level);
                levelDisplay.textContent = `Ø§Ù„Ù…Ø±Ø­Ù„Ø©: ${level}`;
                renderLevels();
            }
            
            // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
            function startGame() {
                gameRunning = true;
                score = 0;
                obstacles = [];
                particles = [];
                speed = levels[currentLevel-1].speed;
                gravity = levels[currentLevel-1].gravity;
                ball.y = canvas.height / 2;
                ball.velocityY = 0;
                obstacleFrequency = 120;
                
                startScreen.style.display = 'none';
                gameOverScreen.style.display = 'none';
                shopScreen.style.display = 'none';
                levelsScreen.style.display = 'none';
                backgroundScreen.style.display = 'none';
                scoreDisplay.textContent = `Ø§Ù„Ù†Ù‚Ø§Ø·: ${score}`;
                
                // Ø¨Ø¯Ø¡ Ø­Ù„Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
                gameLoop();
            }
            
            // Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©
            function gameOver() {
                gameRunning = false;
                cancelAnimationFrame(animationId);
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø© (1 Ø¹Ù…Ù„Ø© Ù„ÙƒÙ„ 5 Ù†Ù‚Ø§Ø·)
                const earned = Math.floor(score / 5);
                coins += earned;
                localStorage.setItem('coins', coins);
                earnedCoinsDisplay.textContent = earned;
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø©
                if (score > highScore) {
                    highScore = score;
                    localStorage.setItem('highScore', highScore);
                    newHighScoreDisplay.style.display = 'block';
                } else {
                    newHighScoreDisplay.style.display = 'none';
                }
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙØªØ­ Ù…Ø±Ø§Ø­Ù„ Ø¬Ø¯ÙŠØ¯Ø©
                const newUnlocked = levels.filter(l => 
                    !unlockedLevels.includes(l.level) && 
                    score >= l.requiredScore
                ).map(l => l.level);
                
                if (newUnlocked.length > 0) {
                    unlockedLevels = [...unlockedLevels, ...newUnlocked];
                    localStorage.setItem('unlockedLevels', JSON.stringify(unlockedLevels));
                }
                
                finalScoreDisplay.textContent = `Ø§Ù„Ù†Ù‚Ø§Ø·: ${score}`;
                highScoreDisplay.textContent = `Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø©: ${highScore}`;
                coinsDisplay.textContent = `Ø§Ù„Ø¹Ù…Ù„Ø§Øª: ${coins}`;
                gameOverScreen.style.display = 'flex';
                
                // ØªØ£Ø«ÙŠØ± Ø¬Ø³ÙŠÙ…Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø³Ø§Ø±Ø©
                for (let i = 0; i < 50; i++) {
                    createParticles(ball.x, ball.y, 1, `hsl(${Math.random() * 360}, 70%, 50%)`);
                }
            }
            
            // Ø­Ù„Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            function gameLoop() {
                animationId = requestAnimationFrame(gameLoop);
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Ø±Ø³Ù… Ø§Ù„Ø®Ù„ÙÙŠØ©
                drawBackground();
                
                // Ø±Ø³Ù… ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒØ±Ø©
                ball.draw();
                ball.update();
                
                // ØªÙˆÙ„ÙŠØ¯ Ø¹Ù‚Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©
                frameCount++;
                if (gameRunning && (obstacles.length === 0 || 
                    (frameCount % obstacleFrequency === 0 && obstacles[obstacles.length - 1].x < canvas.width - 200))) {
                    obstacles.push(new Obstacle());
                    
                    // ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ÙØªØ±Ø© Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª Ù…Ø¹ ØªÙ‚Ø¯Ù… Ø§Ù„Ù„Ø¹Ø¨Ø©
                    if (obstacleFrequency > 60) {
                        obstacleFrequency -= 0.5;
                    }
                }
                
                // Ø±Ø³Ù… ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª
                for (let i = obstacles.length - 1; i >= 0; i--) {
                    obstacles[i].draw();
                    obstacles[i].update();
                    
                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª Ø§Ù„ØªÙŠ Ø®Ø±Ø¬Øª Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø©
                    if (obstacles[i].x + obstacles[i].width < 0) {
                        obstacles.splice(i, 1);
                    }
                }
                
                // Ø±Ø³Ù… ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª
                for (let i = particles.length - 1; i >= 0; i--) {
                    particles[i].draw();
                    particles[i].update();
                    
                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª Ø§Ù„ØªÙŠ Ø§Ø®ØªÙØª
                    if (particles[i].alpha <= 0) {
                        particles.splice(i, 1);
                    }
                }
                
                // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØµØ¹ÙˆØ¨Ø© Ù…Ø¹ Ø§Ù„ÙˆÙ‚Øª
                if (score > 0 && score % 10 === 0 && speed < levels[currentLevel-1].speed * 1.5) {
                    speed += 0.005;
                }
            }
            
            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù
            uploadBtn.addEventListener('click', () => {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const fileType = file.type.split('/')[0];
                const reader = new FileReader();
                
                reader.onload = (event) => {
                    const fileUrl = event.target.result;
                    customBackground = fileUrl;
                    localStorage.setItem('customBackground', fileUrl);
                    
                    if (fileType === 'video') {
                        loadVideoBackground(fileUrl);
                    } else {
                        loadImageBackground(fileUrl);
                    }
                    
                    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø®ØµØµØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                    selectBackground('custom');
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø®Ù„ÙÙŠØ©
                    renderBackgroundOptions();
                };
                
                if (fileType === 'video') {
                    reader.readAsDataURL(file);
                } else {
                    reader.readAsDataURL(file);
                }
            });
            
            // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªØ­ÙƒÙ…
            canvas.addEventListener('click', () => {
                if (gameRunning) {
                    ball.jump();
                }
            });
            
            document.addEventListener('keydown', (e) => {
                if (gameRunning && (e.code === 'Space' || e.key === ' ' || e.key === 'Enter')) {
                    ball.jump();
                }
            });
            
            // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù„Ù…Ø³ Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø©
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (gameRunning) {
                    ball.jump();
                }
            }, { passive: false });
            
            // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            startBtn.addEventListener('click', startGame);
            restartBtn.addEventListener('click', startGame);
            backToMenuBtn.addEventListener('click', () => {
                gameOverScreen.style.display = 'none';
                startScreen.style.display = 'flex';
            });
            
            shopBtn.addEventListener('click', () => {
                startScreen.style.display = 'none';
                shopScreen.style.display = 'flex';
                renderShop();
            });
            
            backFromShopBtn.addEventListener('click', () => {
                shopScreen.style.display = 'none';
                startScreen.style.display = 'flex';
            });
            
            levelsBtn.addEventListener('click', () => {
                startScreen.style.display = 'none';
                levelsScreen.style.display = 'flex';
                renderLevels();
            });
            
            backFromLevelsBtn.addEventListener('click', () => {
                levelsScreen.style.display = 'none';
                startScreen.style.display = 'flex';
            });
            
            backgroundBtn.addEventListener('click', () => {
                startScreen.style.display = 'none';
                backgroundScreen.style.display = 'flex';
                renderBackgroundOptions();
            });
            
            backFromBackgroundBtn.addEventListener('click', () => {
                backgroundScreen.style.display = 'none';
                startScreen.style.display = 'flex';
            });
            
            premiumBtn.addEventListener('click', () => {
                alert('Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø© ØªÙˆÙØ± ÙƒØ±Ø§Øª ÙˆØ®Ù„ÙÙŠØ§Øª Ø­ØµØ±ÙŠØ©! ÙŠÙ…ÙƒÙ†Ùƒ Ø´Ø±Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø© Ù…Ù† Ù…ØªØ¬Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª.');
                // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø±Ø¨Ø· Ù‡Ø°Ø§ Ø¨Ø²Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ ÙÙŠ Ø§Ù„Ù…ØªØ¬Ø±
            });
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
            highScoreDisplay.textContent = `Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø©: ${highScore}`;
            coinsDisplay.textContent = `Ø§Ù„Ø¹Ù…Ù„Ø§Øª: ${coins}`;
            levelDisplay.textContent = `Ø§Ù„Ù…Ø±Ø­Ù„Ø©: ${currentLevel}`;
            
            // ØªØ­Ø¯ÙŠØ« Ø®ØµØ§Ø¦Øµ Ø§Ù„ÙƒØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ù…Ø®ØªØ§Ø±
            ball.radius = ballTypes[selectedBallType].radius;
            ball.color = ballTypes[selectedBallType].color;
            ball.glowColor = ballTypes[selectedBallType].glowColor;
            ball.jumpForce = ballTypes[selectedBallType].jumpForce;
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ù„ÙÙŠØ§Øª Ø§Ù„Ù…Ù…Ù„ÙˆÙƒØ©
            backgrounds.forEach(bg => {
                if (localStorage.getItem(`background_${bg.id}`)) {
                    bg.owned = true;
                }
            });
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø®ØµØµØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
            const savedBackground = localStorage.getItem('customBackground');
            if (savedBackground) {
                customBackground = savedBackground;
                if (savedBackground.endsWith('.mp4') || savedBackground.endsWith('.webm')) {
                    loadVideoBackground(savedBackground);
                } else {
                    loadImageBackground(savedBackground);
                }
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ø®ØµØµØ©ØŒ ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·
                if (currentBackground === 'custom') {
                    if (savedBackground.endsWith('.mp4') || savedBackground.endsWith('.webm')) {
                        loadVideoBackground(savedBackground);
                    } else {
                        loadImageBackground(savedBackground);
                    }
                }
            }
        });
    </script>
</body>
</html>
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 255, 255, 0.3);
            overflow: hidden;
            margin: 20px;
            aspect-ratio: 380/650;
            border: 1px solid #00ffff;
        }
        
        #game-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        #start-screen, #game-over-screen, #shop-screen, #levels-screen, #background-select-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 10;
            text-align: center;
            padding: 20px;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(0, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255, 0, 255, 0.1) 0%, transparent 50%);
        }
        
        #game-over-screen, #shop-screen, #levels-screen, #background-select-screen {
            display: none;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #00ffff;
            text-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff;
            background: linear-gradient(90deg, #00ffff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 2px;
        }
        
        h2 {
            font-size: 1.8rem;
            margin: 15px 0;
            color: #00ffaa;
            text-shadow: 0 0 5px #00ffaa;
        }
        
        p {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: #EEE;
        }
        
        .btn {
            background: linear-gradient(45deg, #00aaff, #0088ff);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(0, 170, 255, 0.5);
            font-weight: bold;
            margin: 10px 0;
            width: 80%;
            max-width: 250px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0, 255, 255, 0.5);
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                transparent 45%,
                rgba(0, 255, 255, 0.5) 50%,
                transparent 55%
            );
            transform: rotate(30deg);
            animation: shine 3s infinite;
        }
        
        @keyframes shine {
            0% { transform: translateX(-100%) rotate(30deg); }
            100% { transform: translateX(100%) rotate(30deg); }
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 20px rgba(0, 170, 255, 0.8);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #aa00ff, #8800ff);
        }
        
        .btn-shop {
            background: linear-gradient(45deg, #00ffaa, #00cc88);
        }
        
        .btn-settings {
            background: linear-gradient(45deg, #ff00aa, #cc0088);
        }
        
        #score-display {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            z-index: 5;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid #00ffff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        #high-score-display {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 1.2rem;
            color: #00ffff;
            z-index: 5;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid #00ffff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        #coins-display {
            position: absolute;
            top: 70px;
            right: 20px;
            font-size: 1.2rem;
            color: #ffcc00;
            z-index: 5;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid #ffcc00;
            box-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
        }
        
        #level-display {
            position: absolute;
            top: 70px;
            left: 20px;
            font-size: 1.2rem;
            color: #00ffaa;
            z-index: 5;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid #00ffaa;
            box-shadow: 0 0 10px rgba(0, 255, 170, 0.5);
        }
        
        #final-score, #new-high-score {
            font-size: 1.5rem;
            margin: 10px 0;
            color: #00ffff;
            text-shadow: 0 0 5px #00ffff;
        }
        
        #new-high-score {
            display: none;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .instructions {
            position: absolute;
            bottom: 20px;
            width: 80%;
            text-align: center;
            font-size: 0.9rem;
            color: #AAA;
        }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ØªØ¬Ø± */
        .shop-items {
            width: 100%;
            max-height: 60%;
            overflow-y: auto;
            margin: 15px 0;
            padding: 0 10px;
        }
        
        .shop-item {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            border: 1px solid rgba(0, 255, 255, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .shop-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                45deg,
                transparent 45%,
                rgba(0, 255, 255, 0.1) 50%,
                transparent 55%
            );
            animation: shine 3s infinite;
        }
        
        .shop-item:hover {
            background: rgba(0, 255, 255, 0.1);
            transform: translateY(-3px);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }
        
        .ball-preview {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-left: 15px;
            box-shadow: 0 0 15px currentColor;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .ball-preview::after {
            content: '';
            position: absolute;
            top: 10%;
            left: 10%;
            width: 20%;
            height: 20%;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.8);
            filter: blur(1px);
        }
        
        .item-info {
            flex: 1;
            text-align: right;
        }
        
        .item-name {
            font-weight: bold;
            font-size: 1.1rem;
            color: white;
            text-shadow: 0 0 5px currentColor;
        }
        
        .item-price {
            color: #ffcc00;
            font-size: 0.9rem;
            text-shadow: 0 0 5px #ffcc00;
        }
        
        .item-description {
            color: #AAA;
            font-size: 0.8rem;
            margin-top: 5px;
        }
        
        .buy-btn {
            background: linear-gradient(45deg, #00ffaa, #00cc88);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(0, 255, 255, 0.5);
            box-shadow: 0 0 10px rgba(0, 255, 170, 0.5);
        }
        
        .buy-btn:disabled {
            background: #333;
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .owned-badge {
            background: linear-gradient(45deg, #00ffaa, #00cc88);
            color: black;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-left: 10px;
            font-weight: bold;
            box-shadow: 0 0 10px rgba(0, 255, 170, 0.5);
        }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ø±Ø§Ø­Ù„ */
        .levels-container {
            width: 100%;
            max-height: 60%;
            overflow-y: auto;
            margin: 15px 0;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 0 10px;
        }
        
        .level-card {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(0, 255, 255, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .level-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                45deg,
                transparent 45%,
                rgba(0, 255, 255, 0.1) 50%,
                transparent 55%
            );
            animation: shine 3s infinite;
        }
        
        .level-card.locked {
            filter: grayscale(80%);
            opacity: 0.7;
        }
        
        .level-card.unlocked:hover {
            background: rgba(0, 255, 255, 0.1);
            transform: translateY(-3px);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }
        
        .level-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #00ffff;
            text-shadow: 0 0 5px #00ffff;
        }
        
        .level-difficulty {
            font-size: 0.8rem;
            color: #AAA;
            margin: 5px 0;
        }
        
        .level-requirements {
            font-size: 0.7rem;
            color: #ffcc00;
            margin-top: 5px;
            text-shadow: 0 0 3px #ffcc00;
        }
        
        .lock-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            color: rgba(255, 255, 255, 0.5);
        }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ© Ù„Ù„ÙƒØ±Ø© */
        .gravity-effect {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        ::-webkit-scrollbar {
            width: 5px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(0, 255, 255, 0.3);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 255, 255, 0.5);
        }
        
        /* Ø®Ù„ÙÙŠØ§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© */
        .background-options {
            width: 100%;
            max-height: 60%;
            overflow-y: auto;
            margin: 15px 0;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 0 10px;
        }
        
        .background-option {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 10px;
            text-align: center;
            border: 1px solid rgba(0, 255, 255, 0.3);
            transition: all 0.3s ease;
            position: relative;
            aspect-ratio: 1/1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        .background-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                45deg,
                transparent 45%,
                rgba(0, 255, 255, 0.1) 50%,
                transparent 55%
            );
            animation: shine 3s infinite;
        }
        
        .background-option:hover {
            background: rgba(0, 255, 255, 0.1);
            transform: translateY(-3px);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }
        
        .background-preview {
            width: 80%;
            height: 80%;
            border-radius: 10px;
            background-size: cover;
            background-position: center;
            margin-bottom: 5px;
            border: 1px solid rgba(0, 255, 255, 0.5);
        }
        
        .background-name {
            font-size: 0.9rem;
            color: white;
            margin-top: 5px;
        }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© */
        .ball-glow {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            filter: blur(10px);
            opacity: 0.7;
            z-index: -1;
        }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª Ø§Ù„Ø´ÙØ§ÙØ© */
        .obstacle-glow {
            position: absolute;
            width: 100%;
            height: 100%;
            filter: blur(5px);
            opacity: 0.8;
            z-index: -1;
        }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø±ÙƒØ© */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .floating {
            animation: float 3s ease-in-out infinite;
        }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ØªÙˆÙ‡Ø¬ */
        @keyframes glow {
            0% { box-shadow: 0 0 5px #00ffff; }
            50% { box-shadow: 0 0 20px #00ffff; }
            100% { box-shadow: 0 0 5px #00ffff; }
        }
        
        /* Ø²Ø± Ø±ÙØ¹ Ø§Ù„Ø®Ù„ÙÙŠØ© */
        #upload-btn {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #00ffff;
            color: #00ffff;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            z-index: 20;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        #upload-btn:hover {
            background: rgba(0, 255, 255, 0.2);
        }
        
        #file-input {
            display: none;
        }
        
        /* ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ */
        @media (max-width: 400px) {
            h1 {
                font-size: 2rem;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 1rem;
            }
            
            #score-display, #high-score-display {
                font-size: 1.2rem;
                padding: 5px 10px;
            }
            
            #coins-display, #level-display {
                font-size: 1rem;
                padding: 5px 10px;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="score-display">Ø§Ù„Ù†Ù‚Ø§Ø·: 0</div>
        <div id="high-score-display">Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø©: 0</div>
        <div id="coins-display">Ø§Ù„Ø¹Ù…Ù„Ø§Øª: 0</div>
        <div id="level-display">Ø§Ù„Ù…Ø±Ø­Ù„Ø©: 1</div>
        
        <canvas id="game-canvas"></canvas>
        
        <button id="upload-btn">Ø±ÙØ¹ Ø®Ù„ÙÙŠØ©</button>
        <input type="file" id="file-input" accept="image/*,video/*">
        
        <div id="start-screen">
            <h1 class="floating">Ù„Ø¹Ø¨Ø© Ø§Ù„ÙƒØ±Ø© Ø§Ù„ÙØ¶Ø§Ø¦ÙŠØ©</h1>
            <p>ØªØ­Ø¯ÙŠ Ø§Ù„Ø³Ø±Ø¹Ø© ÙˆØ§Ù„Ù…Ù‡Ø§Ø±Ø© ÙÙŠ Ø§Ù„ÙØ¶Ø§Ø¡!</p>
            <button class="btn" id="start-btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨</button>
            <button class="btn btn-secondary" id="levels-btn">Ø§Ù„Ù…Ø±Ø§Ø­Ù„</button>
            <button class="btn btn-shop" id="shop-btn">Ù…ØªØ¬Ø± Ø§Ù„ÙƒØ±Ø§Øª</button>
            <button class="btn btn-settings" id="background-btn">Ø®Ù„ÙÙŠØ§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
            <div class="instructions">
                Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± Ø§Ù„Ù…Ø³Ø§ÙØ© Ø£Ùˆ Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ù„Ø¬Ø¹Ù„ Ø§Ù„ÙƒØ±Ø© ØªÙ‚ÙØ²
            </div>
        </div>
        
        <div id="game-over-screen">
            <h1>Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©!</h1>
            <div id="final-score">Ø§Ù„Ù†Ù‚Ø§Ø·: 0</div>
            <div id="new-high-score">!ØªØ­Ù‚ÙŠÙ‚ Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø© Ø¬Ø¯ÙŠØ¯Ø©</div>
            <button class="btn" id="restart-btn">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
            <button class="btn btn-secondary" id="back-to-menu-btn">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
            <div class="instructions">
                Ù„Ù‚Ø¯ ÙƒØ³Ø¨Øª <span id="earned-coins">0</span> Ø¹Ù…Ù„Ø© ÙØ¶Ø§Ø¦ÙŠØ©!
            </div>
        </div>
        
        <div id="shop-screen">
            <h1>Ù…ØªØ¬Ø± Ø§Ù„ÙƒØ±Ø§Øª</h1>
            <p>Ø§Ø®ØªØ± ÙƒØ±ØªÙƒ Ø§Ù„ÙØ¶Ø§Ø¦ÙŠØ© Ø§Ù„Ù…ÙØ¶Ù„Ø© Ø¨Ø®ØµØ§Ø¦Øµ Ù…Ø®ØªÙ„ÙØ©!</p>
            
            <div class="shop-items">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>
            
            <button class="btn" id="back-from-shop-btn">Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
        </div>
        
        <div id="levels-screen">
            <h1>Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ù„Ø¹Ø¨Ø©</h1>
            <p>ØªØ­Ø¯Ù‰ Ù†ÙØ³Ùƒ ÙÙŠ Ù…Ø±Ø§Ø­Ù„ Ù…ØªØ¯Ø±Ø¬Ø© Ø§Ù„ØµØ¹ÙˆØ¨Ø©!</p>
            
            <div class="levels-container">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>
            
            <button class="btn" id="back-from-levels-btn">Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
        </div>
        
        <div id="background-select-screen">
            <h1>Ø®Ù„ÙÙŠØ§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©</h1>
            <p>Ø§Ø®ØªØ± Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„ÙØ¶Ø§Ø¦ÙŠØ© Ø§Ù„ØªÙŠ ØªÙØ¶Ù„Ù‡Ø§!</p>
            
            <div class="background-options">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>
            
            <button class="btn" id="back-from-background-btn">Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Ø¹Ù†Ø§ØµØ± DOM
            const canvas = document.getElementById('game-canvas');
            const ctx = canvas.getContext('2d');
            const startScreen = document.getElementById('start-screen');
            const gameOverScreen = document.getElementById('game-over-screen');
            const shopScreen = document.getElementById('shop-screen');
            const levelsScreen = document.getElementById('levels-screen');
            const backgroundScreen = document.getElementById('background-select-screen');
            const startBtn = document.getElementById('start-btn');
            const restartBtn = document.getElementById('restart-btn');
            const backToMenuBtn = document.getElementById('back-to-menu-btn');
            const shopBtn = document.getElementById('shop-btn');
            const backFromShopBtn = document.getElementById('back-from-shop-btn');
            const levelsBtn = document.getElementById('levels-btn');
            const backFromLevelsBtn = document.getElementById('back-from-levels-btn');
            const backgroundBtn = document.getElementById('background-btn');
            const backFromBackgroundBtn = document.getElementById('back-from-background-btn');
            const scoreDisplay = document.getElementById('score-display');
            const highScoreDisplay = document.getElementById('high-score-display');
            const coinsDisplay = document.getElementById('coins-display');
            const levelDisplay = document.getElementById('level-display');
            const finalScoreDisplay = document.getElementById('final-score');
            const newHighScoreDisplay = document.getElementById('new-high-score');
            const earnedCoinsDisplay = document.getElementById('earned-coins');
            const shopItemsContainer = document.querySelector('.shop-items');
            const levelsContainer = document.querySelector('.levels-container');
            const backgroundOptionsContainer = document.querySelector('.background-options');
            const uploadBtn = document.getElementById('upload-btn');
            const fileInput = document.getElementById('file-input');
            
            // ØªØ¹ÙŠÙŠÙ† Ø­Ø¬Ù… canvas Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§
            function resizeCanvas() {
                const container = document.getElementById('game-container');
                canvas.width = container.clientWidth;
                canvas.height = container.clientHeight;
            }
            
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();
            
            // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
            let gameRunning = false;
            let score = 0;
            let coins = parseInt(localStorage.getItem('coins')) || 0;
            let highScore = parseInt(localStorage.getItem('highScore')) || 0;
            let currentLevel = parseInt(localStorage.getItem('currentLevel')) || 1;
            let unlockedLevels = JSON.parse(localStorage.getItem('unlockedLevels')) || [1];
            let animationId;
            let gravity = 0.5;
            let speed = 3;
            let obstacleFrequency = 120; // Ø¥Ø·Ø§Ø± Ù„ÙƒÙ„ Ø¹Ù‚Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©
            let frameCount = 0;
            let obstacles = [];
            let particles = [];
            let selectedBallType = localStorage.getItem('selectedBall') || 'default';
            let ownedBalls = JSON.parse(localStorage.getItem('ownedBalls')) || ['default'];
            let currentBackground = localStorage.getItem('gameBackground') || 'default';
            let customBackground = localStorage.getItem('customBackground') || null;
            let backgroundImage = null;
            let backgroundVideo = null;
            let videoElement = null;
            
            // Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ÙƒØ±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„Ø´Ø±Ø§Ø¡
            const ballTypes = {
                'default': {
                    name: 'Ø§Ù„ÙƒØ±Ø© Ø§Ù„ÙØ¶Ø§Ø¦ÙŠØ©',
                    price: 0,
                    color: '#00ffff',
                    radius: 20,
                    jumpForce: -12,
                    description: 'Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¨Ø¯ÙˆÙ† Ù…Ù…ÙŠØ²Ø§Øª Ø®Ø§ØµØ©',
                    owned: true,
                    glowColor: 'rgba(0, 255, 255, 0.5)'
                },
                'golden': {
                    name: 'Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©',
                    price: 500,
                    color: '#FFD700',
                    radius: 22,
                    jumpForce: -11.5,
                    description: 'ØªØ¬Ù…Ø¹ Ù†Ù‚Ø§Ø· Ø¥Ø¶Ø§ÙÙŠØ© ÙˆØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø¹Ù…Ù„Ø§Øª Ø£ÙƒØ«Ø±!',
                    owned: ownedBalls.includes('golden'),
                    glowColor: 'rgba(255, 215, 0, 0.5)'
                },
                'bouncy': {
                    name: 'Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ù…Ø±ØªØ¯Ø©',
                    price: 300,
                    color: '#00ffaa',
                    radius: 18,
                    jumpForce: -14,
                    description: 'Ù‚ÙØ²Ø© Ø£Ø¹Ù„Ù‰ Ù…Ø¹ Ø¬Ø§Ø°Ø¨ÙŠØ© Ø£Ù‚Ù„!',
                    owned: ownedBalls.includes('bouncy'),
                    glowColor: 'rgba(0, 255, 170, 0.5)'
                },
                'heavy': {
                    name: 'Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ø«Ù‚ÙŠÙ„Ø©',
                    price: 200,
                    color: '#aa00ff',
                    radius: 24,
                    jumpForce: -10,
                    description: 'ØªØªØ­Ø±Ùƒ Ø¨Ø¨Ø·Ø¡ ÙˆÙ„ÙƒÙ†Ù‡Ø§ ØªÙ‚Ø§ÙˆÙ… Ø§Ù„Ø±ÙŠØ§Ø­!',
                    owned: ownedBalls.includes('heavy'),
                    glowColor: 'rgba(170, 0, 255, 0.5)'
                },
                'fire': {
                    name: 'ÙƒØ±Ø© Ø§Ù„Ù†Ø§Ø±',
                    price: 800,
                    color: '#FF4B2B',
                    radius: 21,
                    jumpForce: -12.5,
                    description: 'ØªØ­Ø±Ù‚ Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª Ø§Ù„ØªÙŠ ØªÙ„Ù…Ø³Ù‡Ø§!',
                    owned: ownedBalls.includes('fire'),
                    glowColor: 'rgba(255, 75, 43, 0.5)'
                },
                'rainbow': {
                    name: 'ÙƒØ±Ø© Ù‚ÙˆØ³ Ù‚Ø²Ø­',
                    price: 1000,
                    color: 'rainbow',
                    radius: 23,
                    jumpForce: -11,
                    description: 'ØªØºÙŠØ± Ù„ÙˆÙ†Ù‡Ø§ Ø¨Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙˆØªØ¬Ø°Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø§Øª!',
                    owned: ownedBalls.includes('rainbow'),
                    glowColor: 'rgba(255, 0, 0, 0.5)'
                }
            };
            
            // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…Ø±Ø§Ø­Ù„
            const levels = [
                {
                    level: 1,
                    name: "Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰",
                    difficulty: "Ø³Ù‡Ù„Ø©",
                    description: "Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ù…Ø¹ Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª Ø§Ù„Ø¨Ø³ÙŠØ·Ø©",
                    requiredScore: 0,
                    speed: 3,
                    gravity: 0.5,
                    gap: 180,
                    obstacleColor: "rgba(0, 255, 255, 0.8)",
                    obstacleGlow: "rgba(0, 255, 255, 0.3)"
                },
                {
                    level: 2,
                    name: "Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©",
                    difficulty: "Ù…ØªÙˆØ³Ø·Ø©",
                    description: "Ø¹Ù‚Ø¨Ø§Øª Ø£Ø³Ø±Ø¹ Ù…Ø¹ ÙØ¬ÙˆØ§Øª Ø£ØµØºØ±",
                    requiredScore: 20,
                    speed: 4,
                    gravity: 0.6,
                    gap: 160,
                    obstacleColor: "rgba(0, 170, 255, 0.8)",
                    obstacleGlow: "rgba(0, 170, 255, 0.3)"
                },
                {
                    level: 3,
                    name: "Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©",
                    difficulty: "ØµØ¹Ø¨Ø©",
                    description: "ØªØ­ÙƒÙ… Ø£ÙØ¶Ù„ Ù…Ø¹ Ø¬Ø§Ø°Ø¨ÙŠØ© Ø£Ù‚ÙˆÙ‰",
                    requiredScore: 50,
                    speed: 5,
                    gravity: 0.7,
                    gap: 140,
                    obstacleColor: "rgba(170, 0, 255, 0.8)",
                    obstacleGlow: "rgba(170, 0, 255, 0.3)"
                },
                {
                    level: 4,
                    name: "Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©",
                    difficulty: "Ù…ØªÙ‚Ø¯Ù…Ø©",
                    description: "Ø³Ø±Ø¹Ø© Ø¹Ø§Ù„ÙŠØ© Ù…Ø¹ Ø¹Ù‚Ø¨Ø§Øª Ù…ØªÙ‚Ø§Ø±Ø¨Ø©",
                    requiredScore: 100,
                    speed: 6,
                    gravity: 0.8,
                    gap: 120,
                    obstacleColor: "rgba(255, 0, 170, 0.8)",
                    obstacleGlow: "rgba(255, 0, 170, 0.3)"
                },
                {
                    level: 5,
                    name: "Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø®Ø§Ù…Ø³Ø©",
                    difficulty: "Ø®Ø¨ÙŠØ±",
                    description: "ØªØ­Ø¯ÙŠ Ø­Ù‚ÙŠÙ‚ÙŠ Ù„Ù„Ù…Ø­ØªØ±ÙÙŠÙ† ÙÙ‚Ø·",
                    requiredScore: 200,
                    speed: 7,
                    gravity: 0.9,
                    gap: 100,
                    obstacleColor: "rgba(255, 85, 0, 0.8)",
                    obstacleGlow: "rgba(255, 85, 0, 0.3)"
                },
                {
                    level: 6,
                    name: "Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©",
                    difficulty: "Ø£Ø³Ø·ÙˆØ±ÙŠØ©",
                    description: "Ø£Ù‚ØµÙ‰ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„ØµØ¹ÙˆØ¨Ø© ÙˆØ§Ù„ØªØ­Ø¯ÙŠ",
                    requiredScore: 500,
                    speed: 8,
                    gravity: 1.0,
                    gap: 80,
                    obstacleColor: "rgba(255, 255, 255, 0.8)",
                    obstacleGlow: "rgba(255, 255, 255, 0.3)"
                }
            ];
            
            // Ø®Ù„ÙÙŠØ§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
            const backgrounds = [
                {
                    id: 'default',
                    name: 'Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„ÙØ¶Ø§Ø¦ÙŠØ©',
                    gradient: ['#000000', '#000033', '#000066'],
                    price: 0,
                    owned: true
                },
                {
                    id: 'nebula',
                    name: 'Ø§Ù„Ø³Ø¯ÙŠÙ…',
                    gradient: ['#1a0033', '#4d004d', '#800080'],
                    price: 200,
                    owned: ownedBalls.includes('background_nebula')
                },
                {
                    id: 'galaxy',
                    name: 'Ø§Ù„Ù…Ø¬Ø±Ø©',
                    gradient: ['#000033', '#000066', '#000099'],
                    price: 300,
                    owned: ownedBalls.includes('background_galaxy')
                },
                {
                    id: 'stars',
                    name: 'Ø§Ù„Ù†Ø¬ÙˆÙ…',
                    gradient: ['#000022', '#001144', '#002266'],
                    price: 250,
                    owned: ownedBalls.includes('background_stars')
                },
                {
                    id: 'planet',
                    name: 'Ø§Ù„ÙƒÙˆÙƒØ¨',
                    gradient: ['#003322', '#006644', '#009966'],
                    price: 350,
                    owned: ownedBalls.includes('background_planet')
                },
                {
                    id: 'supernova',
                    name: 'Ø§Ù„Ø³ÙˆØ¨Ø±Ù†ÙˆÙØ§',
                    gradient: ['#330000', '#660000', '#990000'],
                    price: 400,
                    owned: ownedBalls.includes('background_supernova')
                }
            ];
            
            // Ø§Ù„ÙƒØ±Ø©
            const ball = {
                x: canvas.width * 0.2,
                y: canvas.height / 2,
                radius: ballTypes[selectedBallType].radius,
                color: ballTypes[selectedBallType].color,
                glowColor: ballTypes[selectedBallType].glowColor,
                velocityY: 0,
                jumpForce: ballTypes[selectedBallType].jumpForce,
                rainbowHue: 0,
                
                draw() {
                    // ØªØ£Ø«ÙŠØ± Ù‚ÙˆØ³ Ù‚Ø²Ø­ Ù„Ù„ÙƒØ±Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…Ù† Ù†ÙˆØ¹ rainbow
                    let drawColor = this.color;
                    if (this.color === 'rainbow') {
                        this.rainbowHue = (this.rainbowHue + 2) % 360;
                        drawColor = `hsl(${this.rainbowHue}, 100%, 50%)`;
                        this.glowColor = `hsla(${this.rainbowHue}, 100%, 50%, 0.5)`;
                    }
                    
                    // Ø±Ø³Ù… ØªØ£Ø«ÙŠØ± Ø§Ù„ØªÙˆÙ‡Ø¬
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius * 1.5, 0, Math.PI * 2);
                    ctx.fillStyle = this.glowColor;
                    ctx.fill();
                    
                    // Ø±Ø³Ù… Ø§Ù„Ø¸Ù„
                    ctx.beginPath();
                    ctx.ellipse(this.x, this.y + this.radius + 5, this.radius * 0.8, this.radius * 0.3, 0, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                    ctx.fill();
                    
                    // Ø±Ø³Ù… Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    ctx.fillStyle = drawColor;
                    ctx.fill();
                    ctx.closePath();
                    
                    // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯
                    const gradient = ctx.createRadialGradient(
                        this.x - this.radius/3, 
                        this.y - this.radius/3, 
                        this.radius/4, 
                        this.x, 
                        this.y, 
                        this.radius
                    );
                    gradient.addColorStop(0, 'rgba(255, 255, 255, 0.8)');
                    gradient.addColorStop(0.7, drawColor);
                    gradient.addColorStop(1, shadeColor(drawColor, -30));
                    
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    ctx.fillStyle = gradient;
                    ctx.fill();
                    ctx.closePath();
                    
                    // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯ÙˆØ¯ Ù„Ù„ÙƒØ±Ø©
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                    ctx.closePath();
                    
                    // Ø¥Ø¶Ø§ÙØ© ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„ÙƒØ±Ø©
                    ctx.beginPath();
                    ctx.arc(this.x - this.radius/3, this.y - this.radius/3, this.radius/6, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                    ctx.fill();
                    ctx.closePath();
                    
                    // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„ÙƒØ±Ø©
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                    ctx.lineWidth = 1;
                    ctx.setLineDash([3, 3]);
                    ctx.stroke();
                    ctx.setLineDash([]);
                    ctx.closePath();
                },
                
                update() {
                    this.velocityY += gravity;
                    this.y += this.velocityY;
                    
                    // Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ù„ÙˆÙŠØ© ÙˆØ§Ù„Ø³ÙÙ„ÙŠØ©
                    if (this.y + this.radius > canvas.height) {
                        this.y = canvas.height - this.radius;
                        this.velocityY = 0;
                        createParticles(this.x, this.y + this.radius, 10, this.color === 'rainbow' ? `hsl(${this.rainbowHue}, 100%, 50%)` : this.color);
                    } else if (this.y - this.radius < 0) {
                        this.y = this.radius;
                        this.velocityY = 0;
                    }
                },
                
                jump() {
                    this.velocityY = this.jumpForce;
                    createParticles(this.x, this.y - this.radius, 5, '#FFFFFF');
                }
            };
            
            // Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª
            class Obstacle {
                constructor() {
                    this.width = 40;
                    this.gap = levels[currentLevel-1].gap;
                    this.x = canvas.width;
                    this.topHeight = Math.random() * (canvas.height - this.gap - 100) + 50;
                    this.bottomY = this.topHeight + this.gap;
                    this.color = levels[currentLevel-1].obstacleColor;
                    this.glowColor = levels[currentLevel-1].obstacleGlow;
                    this.passed = false;
                    this.hasCoin = Math.random() > 0.7; // 30% ÙØ±ØµØ© Ù„ÙˆØ¬ÙˆØ¯ Ø¹Ù…Ù„Ø©
                    this.coinY = this.topHeight + this.gap/2;
                    this.coinCollected = false;
                }
                
                draw() {
                    // ØªØ£Ø«ÙŠØ± Ø§Ù„ØªÙˆÙ‡Ø¬ Ù„Ù„Ø¹Ù‚Ø¨Ø§Øª
                    ctx.beginPath();
                    ctx.rect(this.x - 5, 0, this.width + 10, this.topHeight);
                    ctx.rect(this.x - 5, this.bottomY, this.width + 10, canvas.height - this.bottomY);
                    ctx.fillStyle = this.glowColor;
                    ctx.fill();
                    
                    // Ø§Ù„Ø¹Ù‚Ø¨Ø© Ø§Ù„Ø¹Ù„ÙˆÙŠØ© Ù…Ø¹ ØªØ£Ø«ÙŠØ± Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯
                    const topGradient = ctx.createLinearGradient(this.x, 0, this.x + this.width, 0);
                    topGradient.addColorStop(0, shadeColor(this.color, -20));
                    topGradient.addColorStop(0.5, this.color);
                    topGradient.addColorStop(1, shadeColor(this.color, -20));
                    
                    ctx.fillStyle = topGradient;
                    ctx.fillRect(this.x, 0, this.width, this.topHeight);
                    
                    // Ø§Ù„Ø¹Ù‚Ø¨Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ© Ù…Ø¹ ØªØ£Ø«ÙŠØ± Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯
                    const bottomGradient = ctx.createLinearGradient(this.x, this.bottomY, this.x + this.width, this.bottomY);
                    bottomGradient.addColorStop(0, shadeColor(this.color, -20));
                    bottomGradient.addColorStop(0.5, this.color);
                    bottomGradient.addColorStop(1, shadeColor(this.color, -20));
                    
                    ctx.fillStyle = bottomGradient;
                    ctx.fillRect(this.x, this.bottomY, this.width, canvas.height - this.bottomY);
                    
                    // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯ÙˆØ¯ ÙˆØªÙØ§ØµÙŠÙ„ Ø«Ù„Ø§Ø«ÙŠØ© Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯
                    ctx.strokeStyle = 'rgba(0, 0, 0, 0.5)';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(this.x, 0, this.width, this.topHeight);
                    ctx.strokeRect(this.x, this.bottomY, this.width, canvas.height - this.bottomY);
                    
                    // Ø¥Ø¶Ø§ÙØ© Ø®Ø·ÙˆØ· Ø£ÙÙ‚ÙŠØ© Ù„Ù„Ø¹Ù…Ù‚
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
                    ctx.lineWidth = 1;
                    for (let y = 10; y < this.topHeight; y += 15) {
                        ctx.beginPath();
                        ctx.moveTo(this.x, y);
                        ctx.lineTo(this.x + this.width, y);
                        ctx.stroke();
                    }
                    
                    for (let y = this.bottomY + 10; y < canvas.height; y += 15) {
                        ctx.beginPath();
                        ctx.moveTo(this.x, y);
                        ctx.lineTo(this.x + this.width, y);
                        ctx.stroke();
                    }
                    
                    // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ©
                    ctx.strokeStyle = 'rgba(0, 255, 255, 0.5)';
                    ctx.setLineDash([5, 3]);
                    ctx.lineWidth = 1;
                    ctx.strokeRect(this.x + 5, 5, this.width - 10, this.topHeight - 10);
                    ctx.strokeRect(this.x + 5, this.bottomY + 5, this.width - 10, canvas.height - this.bottomY - 10);
                    ctx.setLineDash([]);
                    
                    // Ø±Ø³Ù… Ø§Ù„Ø¹Ù…Ù„Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø© ÙˆÙ„Ù… ÙŠØªÙ… Ø¬Ù…Ø¹Ù‡Ø§
                    if (this.hasCoin && !this.coinCollected && this.x + this.width > 0) {
                        // ØªØ£Ø«ÙŠØ± Ø§Ù„ØªÙˆÙ‡Ø¬ Ù„Ù„Ø¹Ù…Ù„Ø©
                        ctx.beginPath();
                        ctx.arc(this.x + this.width/2, this.coinY, 15, 0, Math.PI * 2);
                        ctx.fillStyle = 'rgba(255, 215, 0, 0.3)';
                        ctx.fill();
                        
                        // Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©
                        const coinGradient = ctx.createRadialGradient(
                            this.x + this.width/2 - 5, 
                            this.coinY - 5, 
                            2, 
                            this.x + this.width/2, 
                            this.coinY, 
                            10
                        );
                        coinGradient.addColorStop(0, '#FFD700');
                        coinGradient.addColorStop(0.5, '#FFCC00');
                        coinGradient.addColorStop(1, '#FFAA00');
                        
                        ctx.beginPath();
                        ctx.arc(this.x + this.width/2, this.coinY, 10, 0, Math.PI * 2);
                        ctx.fillStyle = coinGradient;
                        ctx.fill();
                        
                        ctx.beginPath();
                        ctx.arc(this.x + this.width/2, this.coinY, 10, 0, Math.PI * 2);
                        ctx.strokeStyle = 'rgba(0, 0, 0, 0.5)';
                        ctx.lineWidth = 2;
                        ctx.stroke();
                        
                        ctx.font = 'bold 12px Arial';
                        ctx.fillStyle = 'black';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillText('$', this.x + this.width/2, this.coinY);
                    }
                }
                
                update() {
                    this.x -= speed;
                    
                    // Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø§ØµØ·Ø¯Ø§Ù…
                    if (
                        ball.x + ball.radius > this.x && 
                        ball.x - ball.radius < this.x + this.width && 
                        (ball.y - ball.radius < this.topHeight || ball.y + ball.radius > this.bottomY)
                    ) {
                        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ÙƒØ±Ø© Ø§Ù„Ù†Ø§Ø± ØªØ­Ø±Ù‚ Ø§Ù„Ø¹Ù‚Ø¨Ø©
                        if (selectedBallType === 'fire' && Math.random() > 0.7) {
                            createParticles(this.x + this.width/2, this.topHeight + this.gap/2, 20, '#FF4B2B');
                            obstacles.splice(obstacles.indexOf(this), 1);
                        } else {
                            gameOver();
                        }
                    }
                    
                    // Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ù…Ù„Ø©
                    if (this.hasCoin && !this.coinCollected && 
                        ball.x + ball.radius > this.x && 
                        ball.x - ball.radius < this.x + this.width && 
                        ball.y > this.topHeight && ball.y < this.bottomY) {
                        this.coinCollected = true;
                        coins += (selectedBallType === 'golden' || selectedBallType === 'rainbow') ? 2 : 1;
                        coinsDisplay.textContent = `Ø§Ù„Ø¹Ù…Ù„Ø§Øª: ${coins}`;
                        createParticles(this.x + this.width/2, this.coinY, 15, '#FFD700');
                    }
                    
                    // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù†Ù‚Ø§Ø· Ø¹Ù†Ø¯ ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø¹Ù‚Ø¨Ø©
                    if (!this.passed && ball.x > this.x + this.width) {
                        this.passed = true;
                        score += (selectedBallType === 'golden') ? 2 : 1;
                        scoreDisplay.textContent = `Ø§Ù„Ù†Ù‚Ø§Ø·: ${score}`;
                        createParticles(this.x + this.width/2, this.topHeight + this.gap/2, 15, '#FFD700');
                    }
                }
            }
            
            // Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª Ù„Ù„ØªØ£Ø«ÙŠØ±Ø§Øª
            class Particle {
                constructor(x, y, color) {
                    this.x = x;
                    this.y = y;
                    this.size = Math.random() * 5 + 2;
                    this.color = color;
                    this.velocityX = Math.random() * 6 - 3;
                    this.velocityY = Math.random() * 6 - 3;
                    this.alpha = 1;
                    this.decay = Math.random() * 0.05 + 0.01;
                    this.gravity = 0.1;
                }
                
                draw() {
                    ctx.save();
                    ctx.globalAlpha = this.alpha;
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Ø¥Ø¶Ø§ÙØ© ØªÙˆÙ‡Ø¬ Ù„Ù„Ø¬Ø³ÙŠÙ…Ø§Øª
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size * 1.5, 0, Math.PI * 2);
                    ctx.fillStyle = this.color.replace(')', ', 0.3)').replace('rgb', 'rgba');
                    ctx.fill();
                    ctx.restore();
                }
                
                update() {
                    this.x += this.velocityX;
                    this.y += this.velocityY;
                    this.velocityY += this.gravity;
                    this.alpha -= this.decay;
                }
            }
            
            // ÙˆØ¸ÙŠÙØ© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ø¸Ù„
            function shadeColor(color, percent) {
                if (color.includes('hsl')) return color;
                if (color.includes('rgba')) {
                    const parts = color.match(/rgba\((\d+),\s*(\d+),\s*(\d+),\s*([\d.]+)\)/);
                    if (!parts) return color;
                    
                    let r = parseInt(parts[1]);
                    let g = parseInt(parts[2]);
                    let b = parseInt(parts[3]);
                    const a = parseFloat(parts[4]);
                    
                    r = parseInt(r * (100 + percent) / 100);
                    g = parseInt(g * (100 + percent) / 100);
                    b = parseInt(b * (100 + percent) / 100);
                    
                    r = Math.min(255, Math.max(0, r));
                    g = Math.min(255, Math.max(0, g));
                    b = Math.min(255, Math.max(0, b));
                    
                    return `rgba(${r}, ${g}, ${b}, ${a})`;
                }
                
                let R = parseInt(color.substring(1,3), 16);
                let G = parseInt(color.substring(3,5), 16);
                let B = parseInt(color.substring(5,7), 16);

                R = parseInt(R * (100 + percent) / 100);
                G = parseInt(G * (100 + percent) / 100);
                B = parseInt(B * (100 + percent) / 100);

                R = (R<255)?R:255;  
                G = (G<255)?G:255;  
                B = (B<255)?B:255;  

                R = Math.round(R);
                G = Math.round(G);
                B = Math.round(B);

                const RR = ((R.toString(16).length==1)?"0"+R.toString(16):R.toString(16));
                const GG = ((G.toString(16).length==1)?"0"+G.toString(16):G.toString(16));
                const BB = ((B.toString(16).length==1)?"0"+B.toString(16):B.toString(16));

                return "#"+RR+GG+BB;
            }
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø³ÙŠÙ…Ø§Øª Ù„Ù„ØªØ£Ø«ÙŠØ±Ø§Øª
            function createParticles(x, y, count, color) {
                for (let i = 0; i < count; i++) {
                    particles.push(new Particle(x, y, color));
                }
            }
            
            // Ø±Ø³Ù… Ø®Ù„ÙÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©
            function drawBackground() {
                // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ø®Ù„ÙÙŠØ© Ù…Ø®ØµØµØ©
                if (currentBackground === 'custom' && (backgroundImage || backgroundVideo)) {
                    if (backgroundVideo && videoElement) {
                        // Ø±Ø³Ù… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙƒØ®Ù„ÙÙŠØ©
                        ctx.globalAlpha = 0.7;
                        ctx.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
                        ctx.globalAlpha = 1.0;
                    } else if (backgroundImage) {
                        // Ø±Ø³Ù… Ø§Ù„ØµÙˆØ±Ø© ÙƒØ®Ù„ÙÙŠØ©
                        ctx.globalAlpha = 0.7;
                        ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
                        ctx.globalAlpha = 1.0;
                    }
                    
                    // Ø¥Ø¶Ø§ÙØ© Ø·Ø¨Ù‚Ø© Ø¯Ø§ÙƒÙ†Ø© ÙÙˆÙ‚ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø®ØµØµØ©
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                } else {
                    // Ø®Ù„ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                    const bg = backgrounds.find(b => b.id === currentBackground) || backgrounds[0];
                    
                    // Ø®Ù„ÙÙŠØ© Ù…ØªØ¯Ø±Ø¬Ø©
                    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
                    gradient.addColorStop(0, bg.gradient[0]);
                    gradient.addColorStop(0.5, bg.gradient[1]);
                    gradient.addColorStop(1, bg.gradient[2]);
                    ctx.fillStyle = gradient;
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }
                
                // Ø¥Ø¶Ø§ÙØ© Ù†Ø¬ÙˆÙ… ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                for (let i = 0; i < 100; i++) {
                    if (i % 10 === 0) { // ÙƒÙ„ 10 Ø¥Ø·Ø§Ø±Ø§Øª Ù†Ø­Ø±Ùƒ Ø§Ù„Ù†Ø¬ÙˆÙ…
                        const starX = Math.random() * canvas.width;
                        const starY = Math.random() * canvas.height;
                        const starSize = Math.random() * 2 + 1;
                        
                        ctx.beginPath();
                        ctx.arc(starX, starY, starSize, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
                
                // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ© Ù„Ù„Ø®Ù„ÙÙŠØ©
                ctx.strokeStyle = 'rgba(0, 255, 255, 0.1)';
                ctx.lineWidth = 1;
                
                // Ø®Ø·ÙˆØ· Ø£ÙÙ‚ÙŠØ©
                for (let y = 0; y < canvas.height; y += 50) {
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(canvas.width, y);
                    ctx.stroke();
                }
                
                // Ø®Ø·ÙˆØ· Ø¹Ù…ÙˆØ¯ÙŠØ©
                for (let x = 0; x < canvas.width; x += 50) {
                    ctx.beginPath();
                    ctx.moveTo(x, 0);
                    ctx.lineTo(x, canvas.height);
                    ctx.stroke();
                }
                
                // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø´Ø¨ÙƒØ© ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ©
                ctx.strokeStyle = 'rgba(0, 255, 255, 0.05)';
                ctx.setLineDash([5, 5]);
                for (let y = 0; y < canvas.height; y += 20) {
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(canvas.width, y);
                    ctx.stroke();
                }
                for (let x = 0; x < canvas.width; x += 20) {
                    ctx.beginPath();
                    ctx.moveTo(x, 0);
                    ctx.lineTo(x, canvas.height);
                    ctx.stroke();
                }
                ctx.setLineDash([]);
            }
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ¬Ø±
            function renderShop() {
                shopItemsContainer.innerHTML = '';
                
                for (const [type, ball] of Object.entries(ballTypes)) {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'shop-item';
                    
                    const ballPreview = document.createElement('div');
                    ballPreview.className = 'ball-preview';
                    ballPreview.style.background = type === 'rainbow' 
                        ? 'linear-gradient(45deg, red, orange, yellow, green, blue, indigo, violet)' 
                        : ball.color;
                    ballPreview.style.color = ball.color;
                    
                    const itemInfo = document.createElement('div');
                    itemInfo.className = 'item-info';
                    
                    const itemName = document.createElement('div');
                    itemName.className = 'item-name';
                    itemName.textContent = ball.name;
                    
                    const itemPrice = document.createElement('div');
                    itemPrice.className = 'item-price';
                    itemPrice.textContent = `Ø§Ù„Ø³Ø¹Ø±: ${ball.price} Ø¹Ù…Ù„Ø©`;
                    
                    const itemDesc = document.createElement('div');
                    itemDesc.className = 'item-description';
                    itemDesc.textContent = ball.description;
                    
                    itemInfo.appendChild(itemName);
                    itemInfo.appendChild(itemPrice);
                    itemInfo.appendChild(itemDesc);
                    
                    const buyBtn = document.createElement('button');
                    buyBtn.className = 'buy-btn';
                    
                    if (ball.owned) {
                        if (selectedBallType === type) {
                            buyBtn.textContent = 'Ù…Ø­Ø¯Ø¯Ø©';
                            buyBtn.disabled = true;
                        } else {
                            buyBtn.textContent = 'Ø§Ø®ØªØ±';
                            buyBtn.onclick = () => selectBall(type);
                        }
                    } else {
                        buyBtn.textContent = 'Ø´Ø±Ø§Ø¡';
                        buyBtn.disabled = coins < ball.price;
                        buyBtn.onclick = () => purchaseBall(type, ball.price);
                    }
                    
                    itemEl.appendChild(ballPreview);
                    itemEl.appendChild(itemInfo);
                    itemEl.appendChild(buyBtn);
                    
                    if (ball.owned && selectedBallType === type) {
                        const ownedBadge = document.createElement('div');
                        ownedBadge.className = 'owned-badge';
                        ownedBadge.textContent = 'Ù…Ø­Ø¯Ø¯Ø©';
                        itemEl.appendChild(ownedBadge);
                    } else if (ball.owned) {
                        const ownedBadge = document.createElement('div');
                        ownedBadge.className = 'owned-badge';
                        ownedBadge.textContent = 'Ù…Ù…Ù„ÙˆÙƒØ©';
                        itemEl.appendChild(ownedBadge);
                    }
                    
                    shopItemsContainer.appendChild(itemEl);
                }
            }
            
            // Ø´Ø±Ø§Ø¡ ÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©
            function purchaseBall(type, price) {
                if (coins >= price) {
                    coins -= price;
                    coinsDisplay.textContent = `Ø§Ù„Ø¹Ù…Ù„Ø§Øª: ${coins}`;
                    localStorage.setItem('coins', coins);
                    
                    ballTypes[type].owned = true;
                    ownedBalls.push(type);
                    localStorage.setItem('ownedBalls', JSON.stringify(ownedBalls));
                    
                    renderShop();
                }
            }
            
            // Ø§Ø®ØªÙŠØ§Ø± ÙƒØ±Ø© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
            function selectBall(type) {
                selectedBallType = type;
                localStorage.setItem('selectedBall', type);
                
                // ØªØ­Ø¯ÙŠØ« Ø®ØµØ§Ø¦Øµ Ø§Ù„ÙƒØ±Ø©
                ball.radius = ballTypes[type].radius;
                ball.color = ballTypes[type].color;
                ball.glowColor = ballTypes[type].glowColor;
                ball.jumpForce = ballTypes[type].jumpForce;
                
                renderShop();
            }
            
            // Ø¹Ø±Ø¶ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø®Ù„ÙÙŠØ©
            function renderBackgroundOptions() {
                backgroundOptionsContainer.innerHTML = '';
                
                // Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø± Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø®ØµØµØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
                if (customBackground) {
                    const customBgEl = document.createElement('div');
                    customBgEl.className = 'background-option';
                    customBgEl.style.border = currentBackground === 'custom' ? '2px solid #00ffff' : '1px solid rgba(0, 255, 255, 0.3)';
                    
                    const customPreview = document.createElement('div');
                    customPreview.className = 'background-preview';
                    customPreview.style.backgroundImage = `url(${customBackground})`;
                    customPreview.style.backgroundSize = 'cover';
                    
                    const customName = document.createElement('div');
                    customName.className = 'background-name';
                    customName.textContent = 'Ø®Ù„ÙÙŠØªÙƒ Ø§Ù„Ù…Ø®ØµØµØ©';
                    
                    customBgEl.appendChild(customPreview);
                    customBgEl.appendChild(customName);
                    
                    if (currentBackground === 'custom') {
                        customBgEl.style.boxShadow = '0 0 15px rgba(0, 255, 255, 0.5)';
                    } else {
                        customBgEl.onclick = () => selectBackground('custom');
                    }
                    
                    backgroundOptionsContainer.appendChild(customBgEl);
                }
                
                backgrounds.forEach(bg => {
                    const bgEl = document.createElement('div');
                    bgEl.className = 'background-option';
                    
                    const bgPreview = document.createElement('div');
                    bgPreview.className = 'background-preview';
                    bgPreview.style.background = `linear-gradient(to bottom, ${bg.gradient.join(', ')})`;
                    
                    const bgName = document.createElement('div');
                    bgName.className = 'background-name';
                    bgName.textContent = bg.name;
                    
                    bgEl.appendChild(bgPreview);
                    bgEl.appendChild(bgName);
                    
                    if (bg.owned) {
                        if (currentBackground === bg.id) {
                            bgEl.style.border = '2px solid #00ffff';
                            bgEl.style.boxShadow = '0 0 15px rgba(0, 255, 255, 0.5)';
                        } else {
                            bgEl.onclick = () => selectBackground(bg.id);
                        }
                    } else {
                        const bgPrice = document.createElement('div');
                        bgPrice.className = 'item-price';
                        bgPrice.textContent = `${bg.price} Ø¹Ù…Ù„Ø©`;
                        bgEl.appendChild(bgPrice);
                        
                        const buyBtn = document.createElement('button');
                        buyBtn.className = 'buy-btn';
                        buyBtn.textContent = 'Ø´Ø±Ø§Ø¡';
                        buyBtn.disabled = coins < bg.price;
                        buyBtn.onclick = () => purchaseBackground(bg.id, bg.price);
                        bgEl.appendChild(buyBtn);
                    }
                    
                    backgroundOptionsContainer.appendChild(bgEl);
                });
            }
            
            // Ø´Ø±Ø§Ø¡ Ø®Ù„ÙÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©
            function purchaseBackground(id, price) {
                if (coins >= price) {
                    coins -= price;
                    coinsDisplay.textContent = `Ø§Ù„Ø¹Ù…Ù„Ø§Øª: ${coins}`;
                    localStorage.setItem('coins', coins);
                    
                    const bg = backgrounds.find(b => b.id === id);
                    if (bg) bg.owned = true;
                    
                    localStorage.setItem(`background_${id}`, 'owned');
                    renderBackgroundOptions();
                }
            }
            
            // Ø§Ø®ØªÙŠØ§Ø± Ø®Ù„ÙÙŠØ© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
            function selectBackground(id) {
                currentBackground = id;
                localStorage.setItem('gameBackground', id);
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø®ØµØµØ©ØŒ ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·
                if (id === 'custom') {
                    if (customBackground) {
                        if (customBackground.endsWith('.mp4') || customBackground.endsWith('.webm')) {
                            loadVideoBackground(customBackground);
                        } else {
                            loadImageBackground(customBackground);
                        }
                    }
                } else {
                    // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ ÙÙŠØ¯ÙŠÙˆ ÙŠØ¹Ù…Ù„ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ ÙˆØ§Ø­Ø¯
                    if (videoElement) {
                        videoElement.pause();
                        videoElement = null;
                    }
                    backgroundImage = null;
                }
                
                renderBackgroundOptions();
            }
            
            // ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©
            function loadImageBackground(imageUrl) {
                backgroundImage = new Image();
                backgroundImage.src = imageUrl;
                backgroundImage.onload = () => {
                    if (videoElement) {
                        videoElement.pause();
                        videoElement = null;
                    }
                };
            }
            
            // ØªØ­Ù…ÙŠÙ„ ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø®Ù„ÙÙŠØ©
            function loadVideoBackground(videoUrl) {
                if (videoElement) {
                    videoElement.pause();
                }
                
                videoElement = document.createElement('video');
                videoElement.src = videoUrl;
                videoElement.loop = true;
                videoElement.muted = true;
                videoElement.playsInline = true;
                videoElement.style.display = 'none';
                document.body.appendChild(videoElement);
                
                videoElement.play().catch(e => console.error('Error playing video:', e));
                
                backgroundImage = null;
            }
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø±Ø§Ø­Ù„
            function renderLevels() {
                levelsContainer.innerHTML = '';
                
                levels.forEach(level => {
                    const levelEl = document.createElement('div');
                    levelEl.className = `level-card ${unlockedLevels.includes(level.level) ? 'unlocked' : 'locked'}`;
                    
                    const levelNumber = document.createElement('div');
                    levelNumber.className = 'level-number';
                    levelNumber.textContent = `Ø§Ù„Ù…Ø±Ø­Ù„Ø© ${level.level}`;
                    
                    const levelName = document.createElement('div');
                    levelName.className = 'item-name';
                    levelName.textContent = level.name;
                    
                    const levelDiff = document.createElement('div');
                    levelDiff.className = 'level-difficulty';
                    levelDiff.textContent = `Ø§Ù„ØµØ¹ÙˆØ¨Ø©: ${level.difficulty}`;
                    
                    const levelDesc = document.createElement('div');
                    levelDesc.className = 'item-description';
                    levelDesc.textContent = level.description;
                    
                    levelEl.appendChild(levelNumber);
                    levelEl.appendChild(levelName);
                    levelEl.appendChild(levelDiff);
                    levelEl.appendChild(levelDesc);
                    
                    if (!unlockedLevels.includes(level.level)) {
                        const lockIcon = document.createElement('div');
                        lockIcon.className = 'lock-icon';
                        lockIcon.innerHTML = 'ğŸ”’';
                        
                        const reqText = document.createElement('div');
                        reqText.className = 'level-requirements';
                        reqText.textContent = `ØªØªØ·Ù„Ø¨ ${level.requiredScore} Ù†Ù‚Ø·Ø©`;
                        
                        levelEl.appendChild(lockIcon);
                        levelEl.appendChild(reqText);
                    } else {
                        levelEl.onclick = () => selectLevel(level.level);
                        
                        if (currentLevel === level.level) {
                            levelEl.style.border = '2px solid #00ffff';
                            levelEl.style.boxShadow = '0 0 15px rgba(0, 255, 255, 0.5)';
                        }
                    }
                    
                    levelsContainer.appendChild(levelEl);
                });
            }
            
            // Ø§Ø®ØªÙŠØ§Ø± Ù…Ø±Ø­Ù„Ø©
            function selectLevel(level) {
                currentLevel = level;
                localStorage.setItem('currentLevel', level);
                levelDisplay.textContent = `Ø§Ù„Ù…Ø±Ø­Ù„Ø©: ${level}`;
                renderLevels();
            }
            
            // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
            function startGame() {
                gameRunning = true;
                score = 0;
                obstacles = [];
                particles = [];
                speed = levels[currentLevel-1].speed;
                gravity = levels[currentLevel-1].gravity;
                ball.y = canvas.height / 2;
                ball.velocityY = 0;
                
                startScreen.style.display = 'none';
                gameOverScreen.style.display = 'none';
                shopScreen.style.display = 'none';
                levelsScreen.style.display = 'none';
                backgroundScreen.style.display = 'none';
                scoreDisplay.textContent = `Ø§Ù„Ù†Ù‚Ø§Ø·: ${score}`;
                
                // Ø¨Ø¯Ø¡ Ø­Ù„Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
                gameLoop();
            }
            
            // Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©
            function gameOver() {
                gameRunning = false;
                cancelAnimationFrame(animationId);
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø© (1 Ø¹Ù…Ù„Ø© Ù„ÙƒÙ„ 5 Ù†Ù‚Ø§Ø·)
                const earned = Math.floor(score / 5);
                coins += earned;
                localStorage.setItem('coins', coins);
                earnedCoinsDisplay.textContent = earned;
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø©
                if (score > highScore) {
                    highScore = score;
                    localStorage.setItem('highScore', highScore);
                    newHighScoreDisplay.style.display = 'block';
                } else {
                    newHighScoreDisplay.style.display = 'none';
                }
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙØªØ­ Ù…Ø±Ø§Ø­Ù„ Ø¬Ø¯ÙŠØ¯Ø©
                const newUnlocked = levels.filter(l => 
                    !unlockedLevels.includes(l.level) && 
                    score >= l.requiredScore
                ).map(l => l.level);
                
                if (newUnlocked.length > 0) {
                    unlockedLevels = [...unlockedLevels, ...newUnlocked];
                    localStorage.setItem('unlockedLevels', JSON.stringify(unlockedLevels));
                }
                
                finalScoreDisplay.textContent = `Ø§Ù„Ù†Ù‚Ø§Ø·: ${score}`;
                highScoreDisplay.textContent = `Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø©: ${highScore}`;
                coinsDisplay.textContent = `Ø§Ù„Ø¹Ù…Ù„Ø§Øª: ${coins}`;
                gameOverScreen.style.display = 'flex';
                
                // ØªØ£Ø«ÙŠØ± Ø¬Ø³ÙŠÙ…Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø³Ø§Ø±Ø©
                for (let i = 0; i < 50; i++) {
                    createParticles(ball.x, ball.y, 1, `hsl(${Math.random() * 360}, 70%, 50%)`);
                }
            }
            
            // Ø­Ù„Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            function gameLoop() {
                animationId = requestAnimationFrame(gameLoop);
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Ø±Ø³Ù… Ø§Ù„Ø®Ù„ÙÙŠØ©
                drawBackground();
                
                // Ø±Ø³Ù… ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒØ±Ø©
                ball.draw();
                ball.update();
                
                // ØªÙˆÙ„ÙŠØ¯ Ø¹Ù‚Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©
                frameCount++;
                if (gameRunning && (obstacles.length === 0 || 
                    (frameCount % obstacleFrequency === 0 && obstacles[obstacles.length - 1].x < canvas.width - 200))) {
                    obstacles.push(new Obstacle());
                    
                    // ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ÙØªØ±Ø© Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª Ù…Ø¹ ØªÙ‚Ø¯Ù… Ø§Ù„Ù„Ø¹Ø¨Ø©
                    if (obstacleFrequency > 60) {
                        obstacleFrequency -= 0.5;
                    }
                }
                
                // Ø±Ø³Ù… ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª
                for (let i = obstacles.length - 1; i >= 0; i--) {
                    obstacles[i].draw();
                    obstacles[i].update();
                    
                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª Ø§Ù„ØªÙŠ Ø®Ø±Ø¬Øª Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø©
                    if (obstacles[i].x + obstacles[i].width < 0) {
                        obstacles.splice(i, 1);
                    }
                }
                
                // Ø±Ø³Ù… ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª
                for (let i = particles.length - 1; i >= 0; i--) {
                    particles[i].draw();
                    particles[i].update();
                    
                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª Ø§Ù„ØªÙŠ Ø§Ø®ØªÙØª
                    if (particles[i].alpha <= 0) {
                        particles.splice(i, 1);
                    }
                }
                
                // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØµØ¹ÙˆØ¨Ø© Ù…Ø¹ Ø§Ù„ÙˆÙ‚Øª
                if (score > 0 && score % 10 === 0 && speed < levels[currentLevel-1].speed * 1.5) {
                    speed += 0.005;
                }
            }
            
            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù
            uploadBtn.addEventListener('click', () => {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const fileType = file.type.split('/')[0];
                const reader = new FileReader();
                
                reader.onload = (event) => {
                    const fileUrl = event.target.result;
                    customBackground = fileUrl;
                    localStorage.setItem('customBackground', fileUrl);
                    
                    if (fileType === 'video') {
                        loadVideoBackground(fileUrl);
                    } else {
                        loadImageBackground(fileUrl);
                    }
                    
                    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø®ØµØµØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                    selectBackground('custom');
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø®Ù„ÙÙŠØ©
                    renderBackgroundOptions();
                };
                
                if (fileType === 'video') {
                    reader.readAsDataURL(file);
                } else {
                    reader.readAsDataURL(file);
                }
            });
            
            // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªØ­ÙƒÙ…
            canvas.addEventListener('click', () => {
                if (gameRunning) {
                    ball.jump();
                }
            });
            
            document.addEventListener('keydown', (e) => {
                if (gameRunning && (e.code === 'Space' || e.key === ' ' || e.key === 'Enter')) {
                    ball.jump();
                }
            });
            
            // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù„Ù…Ø³ Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø©
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (gameRunning) {
                    ball.jump();
                }
            }, { passive: false });
            
            // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            startBtn.addEventListener('click', startGame);
            restartBtn.addEventListener('click', startGame);
            backToMenuBtn.addEventListener('click', () => {
                gameOverScreen.style.display = 'none';
                startScreen.style.display = 'flex';
            });
            
            shopBtn.addEventListener('click', () => {
                startScreen.style.display = 'none';
                shopScreen.style.display = 'flex';
                renderShop();
            });
            
            backFromShopBtn.addEventListener('click', () => {
                shopScreen.style.display = 'none';
                startScreen.style.display = 'flex';
            });
            
            levelsBtn.addEventListener('click', () => {
                startScreen.style.display = 'none';
                levelsScreen.style.display = 'flex';
                renderLevels();
            });
            
            backFromLevelsBtn.addEventListener('click', () => {
                levelsScreen.style.display = 'none';
                startScreen.style.display = 'flex';
            });
            
            backgroundBtn.addEventListener('click', () => {
                startScreen.style.display = 'none';
                backgroundScreen.style.display = 'flex';
                renderBackgroundOptions();
            });
            
            backFromBackgroundBtn.addEventListener('click', () => {
                backgroundScreen.style.display = 'none';
                startScreen.style.display = 'flex';
            });
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
            highScoreDisplay.textContent = `Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø©: ${highScore}`;
            coinsDisplay.textContent = `Ø§Ù„Ø¹Ù…Ù„Ø§Øª: ${coins}`;
            levelDisplay.textContent = `Ø§Ù„Ù…Ø±Ø­Ù„Ø©: ${currentLevel}`;
            
            // ØªØ­Ø¯ÙŠØ« Ø®ØµØ§Ø¦Øµ Ø§Ù„ÙƒØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ù…Ø®ØªØ§Ø±
            ball.radius = ballTypes[selectedBallType].radius;
            ball.color = ballTypes[selectedBallType].color;
            ball.glowColor = ballTypes[selectedBallType].glowColor;
            ball.jumpForce = ballTypes[selectedBallType].jumpForce;
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ù„ÙÙŠØ§Øª Ø§Ù„Ù…Ù…Ù„ÙˆÙƒØ©
            backgrounds.forEach(bg => {
                if (localStorage.getItem(`background_${bg.id}`)) {
                    bg.owned = true;
                }
            });
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø®ØµØµØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
            const savedBackground = localStorage.getItem('customBackground');
            if (savedBackground) {
                customBackground = savedBackground;
                if (savedBackground.endsWith('.mp4') || savedBackground.endsWith('.webm')) {
                    loadVideoBackground(savedBackground);
                } else {
                    loadImageBackground(savedBackground);
                }
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ø®ØµØµØ©ØŒ ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·
                if (currentBackground === 'custom') {
                    if (savedBackground.endsWith('.mp4') || savedBackground.endsWith('.webm')) {
                        loadVideoBackground(savedBackground);
                    } else {
                        loadImageBackground(savedBackground);
                    }
                }
            }
        });
    </script>
</body>
</html>
